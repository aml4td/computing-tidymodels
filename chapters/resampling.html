<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; Measuring Performance with Resampling – Tidymodels Computing Supplement</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/grid.html" rel="next">
<link href="../chapters/overfitting.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-109f5ab760e167ab0a7984bfec541ac0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-resampling" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Measuring Performance with Resampling</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../"></a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/aml4td/computing-tidymodels/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/news.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/initial-data-splitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Initial Data Splitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/missing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Missing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/numeric-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transforming Numeric Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/categorical-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with Categorical Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/embeddings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Embeddings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/interactions-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Interactions and Nonlinear Features</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Optmization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/resampling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Measuring Performance with Resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/grid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Grid Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/iterative-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/feature-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/comparing-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Comparing Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Classification</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/cls-metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Characterizing Classification Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Regression</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Characterization</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Finalization</span></span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#requirements" id="toc-requirements" class="nav-link active" data-scroll-target="#requirements"><span class="header-section-number">10.1</span> Requirements</a></li>
  <li>
<a href="#sec-resampling-basics" id="toc-sec-resampling-basics" class="nav-link" data-scroll-target="#sec-resampling-basics"><span class="header-section-number">10.2</span> Basic Methods and Data Structures</a>
  <ul class="collapse">
<li><a href="#sec-rsplits" id="toc-sec-rsplits" class="nav-link" data-scroll-target="#sec-rsplits"><span class="header-section-number">10.2.1</span> Split Objects</a></li>
  </ul>
</li>
  <li><a href="#sec-resampling-todo" id="toc-sec-resampling-todo" class="nav-link" data-scroll-target="#sec-resampling-todo"><span class="header-section-number">10.3</span> Basic Resampling Tools</a></li>
  <li><a href="#sec-validation-sets" id="toc-sec-validation-sets" class="nav-link" data-scroll-target="#sec-validation-sets"><span class="header-section-number">10.4</span> Validation Sets</a></li>
  <li><a href="#sec-cv-mc" id="toc-sec-cv-mc" class="nav-link" data-scroll-target="#sec-cv-mc"><span class="header-section-number">10.5</span> Monte Carlo Cross-Validation</a></li>
  <li><a href="#sec-cv" id="toc-sec-cv" class="nav-link" data-scroll-target="#sec-cv"><span class="header-section-number">10.6</span> V-Fold Cross-Validation</a></li>
  <li><a href="#sec-bootstrap" id="toc-sec-bootstrap" class="nav-link" data-scroll-target="#sec-bootstrap"><span class="header-section-number">10.7</span> The Bootstrap</a></li>
  <li><a href="#sec-time-series-resampling" id="toc-sec-time-series-resampling" class="nav-link" data-scroll-target="#sec-time-series-resampling"><span class="header-section-number">10.8</span> Time Series Data</a></li>
  <li><a href="#sec-spatial-resampling" id="toc-sec-spatial-resampling" class="nav-link" data-scroll-target="#sec-spatial-resampling"><span class="header-section-number">10.9</span> Spatial Data</a></li>
  <li><a href="#sec-multilevel-resampling" id="toc-sec-multilevel-resampling" class="nav-link" data-scroll-target="#sec-multilevel-resampling"><span class="header-section-number">10.10</span> Grouped or Multi-Level Data</a></li>
  <li>
<a href="#sec-resampled-models" id="toc-sec-resampled-models" class="nav-link" data-scroll-target="#sec-resampled-models"><span class="header-section-number">10.11</span> Estimating Performance</a>
  <ul class="collapse">
<li><a href="#sec-parallel-resamples" id="toc-sec-parallel-resamples" class="nav-link" data-scroll-target="#sec-parallel-resamples"><span class="header-section-number">10.11.1</span> Parallel Processing</a></li>
  <li><a href="#sec-function-arguments" id="toc-sec-function-arguments" class="nav-link" data-scroll-target="#sec-function-arguments"><span class="header-section-number">10.11.2</span> Other Options</a></li>
  <li><a href="#sec-extraction" id="toc-sec-extraction" class="nav-link" data-scroll-target="#sec-extraction"><span class="header-section-number">10.11.3</span> Extracting Results</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-resampling" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Measuring Performance with Resampling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This chapter outlines how to create objects to facilitate resampling. At the end, <a href="#sec-resampled-models" class="quarto-xref"><span>Section 10.11</span></a> illustrates how to use the resampling objects to produce good estimates of performance for a model.</p>
<section id="requirements" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="requirements">
<span class="header-section-number">10.1</span> Requirements</h2>
<p>We will use the <code>ames</code>, <code>concrete</code>, and <code>Chicago</code> data sets from the <span class="pkg"><a href="https://cran.r-project.org/package=modeldata">modeldata</a></span> package (which is automatically loaded below) to illustrate some of the methods. The other data, <code>Orthodont</code>, can be obtained in the <span class="pkg"><a href="https://cran.r-project.org/package=nlme">nlme</a></span> package which comes with each R installation.</p>
<p>You’ll need 8 packages (<span class="pkg"><a href="https://cran.r-project.org/package=Cubist">Cubist</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=future.mirai">future.mirai</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=parallelly">parallelly</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=probably">probably</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=rules">rules</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=spatialsample">spatialsample</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=tidymodels">tidymodels</a></span>, and <span class="pkg"><a href="https://cran.r-project.org/package=tidysdm">tidysdm</a></span>) for this chapter. You can install them via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">req_pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cubist"</span>, <span class="st">"future.mirai"</span>, <span class="st">"parallelly"</span>, <span class="st">"probably"</span>, <span class="st">"rules"</span>, <span class="st">"spatialsample"</span>, </span>
<span>             <span class="st">"tidymodels"</span>, <span class="st">"tidysdm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check to see if they are installed: </span></span>
<span><span class="va">pkg_installed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">req_pkg</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/is_installed.html">is_installed</a></span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install missing packages: </span></span>
<span><span class="kw">if</span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="op">!</span><span class="va">pkg_installed</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">install_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pkg_installed</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">pkg_installed</span><span class="op">]</span></span>
<span>  <span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html">pak</a></span><span class="op">(</span><span class="va">install_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s load the meta package and manage some between-package function conflicts.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-resampling-basics" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="sec-resampling-basics">
<span class="header-section-number">10.2</span> Basic Methods and Data Structures</h2>
<p>The <span class="pkg"><a href="https://cran.r-project.org/package=rsample">rsample</a></span> package provides many functions to facilitate resampling. For now, we’ll assume an initial split into a training and test set has been made (but see <a href="#sec-validation-sets" class="quarto-xref"><span>Section 10.4</span></a> below for three-way splits).</p>
<p>Let’s use the concrete data for illustration:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">82</span><span class="op">)</span></span>
<span><span class="va">concrete_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">concrete</span><span class="op">)</span></span>
<span><span class="va">concrete_tr</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span><span class="va">concrete_te</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All resampling methods use the training set as the substrate for creating resamples. We’ll demonstrate the main tools and functions using basic bootstrap resampling and then discuss the other resampling methods.</p>
<p>The function that we’ll use to demonstrate is <code><a href="https://rsample.tidymodels.org/reference/bootstraps.html">rsample::bootstraps()</a></code>. Its main option, <code>times</code>, describes how many resamples to create. Let’s make five resamples:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">380</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span> <span class="op">&lt;-</span> <span class="fu">bootstraps</span><span class="op">(</span><span class="va">concrete</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates a tibble with five rows and two columns:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">concrete_rs</span></span>
<span><span class="co">#&gt; # Bootstrap sampling </span></span>
<span><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span><span class="co">#&gt;   splits             id        </span></span>
<span><span class="co">#&gt;   &lt;list&gt;             &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 &lt;split [1030/355]&gt; Bootstrap1</span></span>
<span><span class="co">#&gt; 2 &lt;split [1030/408]&gt; Bootstrap2</span></span>
<span><span class="co">#&gt; 3 &lt;split [1030/369]&gt; Bootstrap3</span></span>
<span><span class="co">#&gt; 4 &lt;split [1030/375]&gt; Bootstrap4</span></span>
<span><span class="co">#&gt; 5 &lt;split [1030/378]&gt; Bootstrap5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll investigate the <code>splits</code> column in a bit. The <code>id</code> column gives each row a name (corresponding to a resample). Some resampling methods, such as repeated cross-validation, can have additional identification columns.</p>
<p>The object has two additional classes <code>bootstraps</code> and <code>rset</code> that differentiate it from a standard tibble.</p>
<p>This collection of splits is called an <code>"rset"</code> and has specific rules. The object above is defined as a set of five bootstrap samples. If we delete a row, it breaks that definition, and the class drops back down to a basic tibble:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">concrete_rs</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;   splits             id        </span></span>
<span><span class="co">#&gt;   &lt;list&gt;             &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 &lt;split [1030/408]&gt; Bootstrap2</span></span>
<span><span class="co">#&gt; 2 &lt;split [1030/369]&gt; Bootstrap3</span></span>
<span><span class="co">#&gt; 3 &lt;split [1030/375]&gt; Bootstrap4</span></span>
<span><span class="co">#&gt; 4 &lt;split [1030/378]&gt; Bootstrap5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The “A tibble: 4 × 2” title is different from the original title of “Bootstrap sampling.” This, and the class values, give away the difference. You can add columns without violating the definition.</p>
<section id="sec-rsplits" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="sec-rsplits">
<span class="header-section-number">10.2.1</span> Split Objects</h3>
<p>Note the <code>splits</code> column in the output above. This is a <em>list column</em> in the data frame. It contains an <code>rsplit</code> object that tells us which rows of the training set go into our analysis and assessment sets. As a reminder:</p>
<ul>
<li>The <strong>analysis set</strong> (of size <span class="math inline">\(n_{fit}\)</span>) estimates quantities associated with preprocessing, model training, and postprocessing.</li>
<li>The <strong>assessment set</strong> (<span class="math inline">\(n_{pred}\)</span>) is only used for prediction so that we can compute measures of model effectiveness (e.g., RMSE, classification accuracy, etc).</li>
</ul>
<p>When we see output “<code>&lt;split [1030/408]&gt;</code>” this indicates a binary split where the analysis set has 1030 rows, and the assessment set has 408 rows.</p>
<p>To get the analysis and assessment sets, there are two eponymous functions. For a specific split:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ex_split</span> <span class="op">&lt;-</span> <span class="va">concrete_rs</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ex_split</span></span>
<span><span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span></span>
<span><span class="co">#&gt; &lt;1030/355/1030&gt;</span></span>
<span></span>
<span><span class="fu">analysis</span><span class="op">(</span><span class="va">ex_split</span><span class="op">)</span>   <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1030    9</span></span>
<span><span class="fu">assessment</span><span class="op">(</span><span class="va">ex_split</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 355   9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to get the specific row indices of the training set:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ex_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">ex_split</span>, data <span class="op">=</span> <span class="st">"assessment"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ex_ind</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  2  5  6 14 15 17</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ex_ind</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 355</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You shouldn’t really have to interact with these objects at all.</p>
</section></section><section id="sec-resampling-todo" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="sec-resampling-todo">
<span class="header-section-number">10.3</span> Basic Resampling Tools</h2>
<p><span class="pkg"><a href="https://cran.r-project.org/package=rsample">rsample</a></span> contains several functions that resample data whose rows are thought to be statistically independent of one another. Almost all of these functions contain options for stratified resampling.</p>
<p>We’ll show an example with basic 10-fold cross-validation below in <a href="#sec-resampled-models" class="quarto-xref"><span>Section 10.11</span></a>.</p>
<p>Let’s examine each flavor of resampling mentioned in the book chapter.</p>
</section><section id="sec-validation-sets" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="sec-validation-sets">
<span class="header-section-number">10.4</span> Validation Sets</h2>
<p>To create a validation set, the first split should use <code><a href="https://rsample.tidymodels.org/reference/initial_validation_split.html">rsample::initial_validation_split()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">426</span><span class="op">)</span></span>
<span><span class="va">concrete_split</span> <span class="op">&lt;-</span> <span class="fu">initial_validation_split</span><span class="op">(</span><span class="va">concrete</span>, prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">concrete_tr</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span><span class="va">concrete_vl</span> <span class="op">&lt;-</span> <span class="fu">validation</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span><span class="va">concrete_te</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To make an <code>rset</code> object that can be used with most of tidymodel’s resampling machinery, we can use the <code><a href="https://rsample.tidymodels.org/reference/validation_set.html">rsample::validation_set()</a></code> function to produce one (taking the initial three-way split as input):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">concrete_rs</span> <span class="op">&lt;-</span> <span class="fu">validation_set</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   splits            id        </span></span>
<span><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 &lt;split [824/103]&gt; validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, we can use <code>concrete_rs</code> as if it were any other <code>rset</code> object.</p>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-validation"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-cv-mc" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="sec-cv-mc">
<span class="header-section-number">10.5</span> Monte Carlo Cross-Validation</h2>
<p>The relevant function here is <code>mc_cv()</code> with two main arguments:</p>
<ul>
<li>
<code>times</code> is the number of resamples</li>
<li>
<code>prop</code> is the proportion of the data that is allocated to the analysis set.</li>
</ul>
<p>For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">380</span><span class="op">)</span></span>
<span><span class="fu">mc_cv</span><span class="op">(</span><span class="va">concrete_tr</span>, times <span class="op">=</span> <span class="fl">3</span>, prop <span class="op">=</span> <span class="fl">9</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Monte Carlo cross-validation (0.9/0.1) with 3 resamples </span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;   splits           id       </span></span>
<span><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 &lt;split [741/83]&gt; Resample1</span></span>
<span><span class="co">#&gt; 2 &lt;split [741/83]&gt; Resample2</span></span>
<span><span class="co">#&gt; 3 &lt;split [741/83]&gt; Resample3</span></span>
<span></span>
<span><span class="co"># or </span></span>
<span></span>
<span><span class="fu">mc_cv</span><span class="op">(</span><span class="va">concrete_tr</span>, times <span class="op">=</span> <span class="fl">2</span>, prop <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span>  <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Monte Carlo cross-validation (0.67/0.33) with 2 resamples </span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   splits            id       </span></span>
<span><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 &lt;split [549/275]&gt; Resample1</span></span>
<span><span class="co">#&gt; 2 &lt;split [549/275]&gt; Resample2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-cv-mc"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-cv" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="sec-cv">
<span class="header-section-number">10.6</span> V-Fold Cross-Validation</h2>
<p>Basic V-fold cross-validation is performed using <code>vfold_cv()</code>. The <code>v</code> argument defines the number of folds and defaults to <code>v = 10</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">380</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">concrete_tr</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span></span>
<span><span class="co">#&gt; #  10-fold cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span><span class="co">#&gt;   splits           id    </span></span>
<span><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 &lt;split [741/83]&gt; Fold01</span></span>
<span><span class="co">#&gt; 2 &lt;split [741/83]&gt; Fold02</span></span>
<span><span class="co">#&gt; 3 &lt;split [741/83]&gt; Fold03</span></span>
<span><span class="co">#&gt; 4 &lt;split [741/83]&gt; Fold04</span></span>
<span><span class="co">#&gt; 5 &lt;split [742/82]&gt; Fold05</span></span>
<span><span class="co">#&gt; 6 &lt;split [742/82]&gt; Fold06</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with the other tools, the <code>strata</code> argument can balance the outcome distributions across folds. It takes a single column as input.</p>
<p>Another argument of note is <code>repeats</code>, which describes how many sets of V resamples should be created. This generated an additional column called <code>id2</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">380</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">concrete_tr</span>, repeats <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span></span>
<span><span class="co">#&gt; #  10-fold cross-validation repeated 2 times </span></span>
<span><span class="co">#&gt; # A tibble: 20 × 3</span></span>
<span><span class="co">#&gt;   splits           id      id2   </span></span>
<span><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 &lt;split [741/83]&gt; Repeat1 Fold01</span></span>
<span><span class="co">#&gt; 2 &lt;split [741/83]&gt; Repeat1 Fold02</span></span>
<span><span class="co">#&gt; 3 &lt;split [741/83]&gt; Repeat1 Fold03</span></span>
<span><span class="co">#&gt; 4 &lt;split [741/83]&gt; Repeat1 Fold04</span></span>
<span><span class="co">#&gt; 5 &lt;split [742/82]&gt; Repeat1 Fold05</span></span>
<span><span class="co">#&gt; 6 &lt;split [742/82]&gt; Repeat1 Fold06</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-cv"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-bootstrap" class="level2" data-number="10.7"><h2 data-number="10.7" class="anchored" data-anchor-id="sec-bootstrap">
<span class="header-section-number">10.7</span> The Bootstrap</h2>
<p>First, there are special occasions when the regular set of bootstrap samples needs to be supplemented with an additional resample that can be used to measure the resubstitution rate (predicting the analysis set after fitting the data on the same analysis set). The function that produces this extra row is called <code>apparent()</code>, which is the same name as the function argument:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">380</span><span class="op">)</span></span>
<span><span class="va">concrete_rs</span> <span class="op">&lt;-</span> <span class="fu">bootstraps</span><span class="op">(</span><span class="va">concrete</span>, times <span class="op">=</span> <span class="fl">5</span>, apparent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the <code>id</code> column reflects this, and the split label shows that the analysis and assessment sets are the same size.</p>
<p>The tidymodels resampling functions are aware of the potential presence of the “apparent” sample and will <em>not</em> include it at inappropriate times. For example, if we resample a model with and without using <code>apparent = TRUE</code>, we’ll get the same results as long as we use the same random number seed to make each set of resamples.</p>
<p>Secondly, there is a <code>strata</code> argument for this function. That enables different bootstrap samples to be taken within each stratum, which are combined into the final resampling set. <em>Technically</em>, this isn’t a bootstrap sample, but it is probably close enough to be useful.</p>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-bootstrap"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-time-series-resampling" class="level2" data-number="10.8"><h2 data-number="10.8" class="anchored" data-anchor-id="sec-time-series-resampling">
<span class="header-section-number">10.8</span> Time Series Data</h2>
<p>Usually, the most recent data are used to evaluate performance for time series data. The function <code>initial_time_split()</code> can be used to make the initial split. We’ll use the <code>Chicago</code> data to demonstrate:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Chicago</span><span class="op">)</span></span>
<span><span class="co"># To get 30 days of data</span></span>
<span><span class="va">prop_30</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">30</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span></span>
<span><span class="va">chi_split</span> <span class="op">&lt;-</span> <span class="fu">initial_time_split</span><span class="op">(</span><span class="va">Chicago</span>, prop <span class="op">=</span> <span class="va">prop_30</span><span class="op">)</span></span>
<span><span class="va">chi_split</span></span>
<span><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span><span class="co">#&gt; &lt;5668/30/5698&gt;</span></span>
<span></span>
<span><span class="va">chi_tr</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">chi_split</span><span class="op">)</span></span>
<span><span class="va">chi_te</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">chi_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s say that we want</p>
<ul>
<li>5,000 days in our analysis set,</li>
<li>30 day assessment sets</li>
<li>shift the 30-day window 30 days ahead</li>
</ul>
<p>The data set has a column with the <code>Date</code> class. We can use this to partition the data in case there is an unequal number of data points in our 30-day period. The <code>sliding_period()</code> can be used with a date or date/time input, while <code>sliding_index()</code> can be used for equally spaced data.</p>
<p>Let’s use <code>sliding_period()</code> for this example, annotate the argument logic in comments, and then compute a few columns for the start/stop dates for the analysis and assessment sets (for illustration):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_rs</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">sliding_period</span><span class="op">(</span></span>
<span>    <span class="va">chi_tr</span>,</span>
<span>    index <span class="op">=</span> <span class="va">date</span>,</span>
<span>    period <span class="op">=</span> <span class="st">"day"</span>,   <span class="co"># Could be "year", "quarter", "month", "week", or "day"</span></span>
<span>    lookback <span class="op">=</span> <span class="fl">5000</span>,  <span class="co"># 5000 days in the analysis sets</span></span>
<span>    assess_start <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Start the assessment set 1 day after analysis set</span></span>
<span>    assess_stop <span class="op">=</span> <span class="fl">30</span>, <span class="co"># Stop the assessment set 20 days after analysis set</span></span>
<span>    step <span class="op">=</span> <span class="fl">30</span>         <span class="co"># Jump ahead 30 days between resamples; no assessment overlap in assessments</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    fit_start <span class="op">=</span>  <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">analysis</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    fit_stop <span class="op">=</span>   <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">analysis</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    perf_start <span class="op">=</span> <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">assessment</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    perf_stop <span class="op">=</span>  <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">assessment</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">chi_rs</span></span>
<span><span class="co">#&gt; # Sliding period resampling </span></span>
<span><span class="co">#&gt; # A tibble: 22 × 6</span></span>
<span><span class="co">#&gt;   splits            id      fit_start  fit_stop   perf_start perf_stop </span></span>
<span><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 &lt;split [5001/30]&gt; Slice01 2001-01-22 2014-10-01 2014-10-02 2014-10-31</span></span>
<span><span class="co">#&gt; 2 &lt;split [5001/30]&gt; Slice02 2001-02-21 2014-10-31 2014-11-01 2014-11-30</span></span>
<span><span class="co">#&gt; 3 &lt;split [5001/30]&gt; Slice03 2001-03-23 2014-11-30 2014-12-01 2014-12-30</span></span>
<span><span class="co">#&gt; 4 &lt;split [5001/30]&gt; Slice04 2001-04-22 2014-12-30 2014-12-31 2015-01-29</span></span>
<span><span class="co">#&gt; 5 &lt;split [5001/30]&gt; Slice05 2001-05-22 2015-01-29 2015-01-30 2015-02-28</span></span>
<span><span class="co">#&gt; 6 &lt;split [5001/30]&gt; Slice06 2001-06-21 2015-02-28 2015-03-01 2015-03-30</span></span>
<span><span class="co">#&gt; # ℹ 16 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first analysis set starts on 2001-01-22 and ends 5,000 days later on 2014-10-01. The next day (2014-10-02), the analysis set includes 30 days and stops on 2014-10-31.</p>
<p>For the second resample, the analysis and assessment sets both start 30 days later.</p>
<p>Here is a visualization of the date periods defined by the resampling scheme that illustrates why the method is sometimes called rolling origin forecast resampling. The figure also shows that the assessment sets are very small compared to the analysis sets.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_rs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">fit_start</span>,  xend <span class="op">=</span> <span class="va">fit_stop</span>,  yend <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">perf_start</span>, xend <span class="op">=</span> <span class="va">perf_stop</span>, yend <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="resampling_files/figure-html/rolling-analysis-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>One variation of this approach is to cumulately increase the analysis set by keeping the starting date the same (inside of sliding/rolling). For this, we can make the “lookback” infinite but use the <code>skip</code> argument to remove the large number of resamples that contain fewer than 5,000 days in the analysis sets:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_rs</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">sliding_period</span><span class="op">(</span></span>
<span>    <span class="va">chi_tr</span>,</span>
<span>    index <span class="op">=</span> <span class="va">date</span>,</span>
<span>    period <span class="op">=</span> <span class="st">"day"</span>, </span>
<span>    lookback <span class="op">=</span> <span class="cn">Inf</span>,   <span class="co"># Use all data before assessment</span></span>
<span>    assess_start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    assess_stop <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    step <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    skip <span class="op">=</span> <span class="fl">5000</span>       <span class="co"># Drop first 5000 results so assessment starts at same time </span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    fit_start <span class="op">=</span>  <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">analysis</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    fit_stop <span class="op">=</span>   <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">analysis</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    perf_start <span class="op">=</span> <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">assessment</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    perf_stop <span class="op">=</span>  <span class="fu">map_vec</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">assessment</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">chi_rs</span></span>
<span><span class="co">#&gt; # Sliding period resampling </span></span>
<span><span class="co">#&gt; # A tibble: 22 × 6</span></span>
<span><span class="co">#&gt;   splits            id      fit_start  fit_stop   perf_start perf_stop </span></span>
<span><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 &lt;split [5001/30]&gt; Slice01 2001-01-22 2014-10-01 2014-10-02 2014-10-31</span></span>
<span><span class="co">#&gt; 2 &lt;split [5031/30]&gt; Slice02 2001-01-22 2014-10-31 2014-11-01 2014-11-30</span></span>
<span><span class="co">#&gt; 3 &lt;split [5061/30]&gt; Slice03 2001-01-22 2014-11-30 2014-12-01 2014-12-30</span></span>
<span><span class="co">#&gt; 4 &lt;split [5091/30]&gt; Slice04 2001-01-22 2014-12-30 2014-12-31 2015-01-29</span></span>
<span><span class="co">#&gt; 5 &lt;split [5121/30]&gt; Slice05 2001-01-22 2015-01-29 2015-01-30 2015-02-28</span></span>
<span><span class="co">#&gt; 6 &lt;split [5151/30]&gt; Slice06 2001-01-22 2015-02-28 2015-03-01 2015-03-30</span></span>
<span><span class="co">#&gt; # ℹ 16 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the values in the <code>fit_stop</code> column are the same. Visually:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chi_rs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">fit_start</span>,  xend <span class="op">=</span> <span class="va">fit_stop</span>,  yend <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">perf_start</span>, xend <span class="op">=</span> <span class="va">perf_stop</span>, yend <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="resampling_files/figure-html/cumulative-analysis-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-time-series-resampling"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-spatial-resampling" class="level2" data-number="10.9"><h2 data-number="10.9" class="anchored" data-anchor-id="sec-spatial-resampling">
<span class="header-section-number">10.9</span> Spatial Data</h2>
<p>We split the Ames data into a training and testing set back in <a href="initial-data-splitting.html#sec-spatial-splitting" class="quarto-xref"><span>Section 3.8</span></a> using this code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/spatialsample">spatialsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EvolEcolGroup/tidysdm">tidysdm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_sf</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">318</span><span class="op">)</span></span>
<span><span class="va">ames_block_buff_split</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://evolecolgroup.github.io/tidysdm/reference/spatial_initial_split.html">spatial_initial_split</a></span><span class="op">(</span></span>
<span>    <span class="va">ames_sf</span>, </span>
<span>    prop <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>    strategy <span class="op">=</span> <span class="va">spatial_block_cv</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">25</span>, </span>
<span>    square <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    buffer <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_tr</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">ames_block_buff_split</span><span class="op">)</span></span>
<span><span class="va">ames_te</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">ames_block_buff_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The options for resampling are basically the same as the initial split. For example, with block resampling, we create a grid on the training set and allocate specific grids to specific assessment sets. Buffering can also be used for each resample. The <code><a href="https://spatialsample.tidymodels.org/reference/spatial_block_cv.html">spatial_block_cv()</a></code> function in the <span class="pkg"><a href="https://cran.r-project.org/package=spatialsample">spatialsample</a></span> package and has a <code>v</code> argument for the number of resamples:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">652</span><span class="op">)</span></span>
<span><span class="va">ames_rs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://spatialsample.tidymodels.org/reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span></span>
<span>    <span class="va">ames_tr</span>, </span>
<span>    v <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">25</span>, </span>
<span>    square <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    buffer <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="va">ames_rs</span></span>
<span><span class="co">#&gt; #  10-fold spatial block cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span><span class="co">#&gt;   splits             id    </span></span>
<span><span class="co">#&gt;   &lt;list&gt;             &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 &lt;split [1047/167]&gt; Fold01</span></span>
<span><span class="co">#&gt; 2 &lt;split [1098/182]&gt; Fold02</span></span>
<span><span class="co">#&gt; 3 &lt;split [1225/147]&gt; Fold03</span></span>
<span><span class="co">#&gt; 4 &lt;split [1130/174]&gt; Fold04</span></span>
<span><span class="co">#&gt; 5 &lt;split [1123/155]&gt; Fold05</span></span>
<span><span class="co">#&gt; 6 &lt;split [1235/95]&gt;  Fold06</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is an overall <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method that can be used to show the grid:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">ames_rs</span>, cex <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>, show_grid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="resampling_files/figure-html/ames-split-block-rs-all-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can also <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> individual splits to see the analysis and assessment set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">ames_rs</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, cex <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="resampling_files/figure-html/ames-split-block-rs-single-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-spatial-resampling"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-multilevel-resampling" class="level2" data-number="10.10"><h2 data-number="10.10" class="anchored" data-anchor-id="sec-multilevel-resampling">
<span class="header-section-number">10.10</span> Grouped or Multi-Level Data</h2>
<p>Returning to the orthodontal data from <a href="initial-data-splitting.html#sec-multilevel-splitting" class="quarto-xref"><span>Section 3.7</span></a>, we use the initial split:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Orthodont</span>, package <span class="op">=</span> <span class="st">"nlme"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">93</span><span class="op">)</span></span>
<span><span class="va">orth_split</span> <span class="op">&lt;-</span> <span class="fu">group_initial_split</span><span class="op">(</span><span class="va">Orthodont</span>, group <span class="op">=</span> <span class="va">Subject</span>, prop <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">orth_tr</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">orth_split</span><span class="op">)</span></span>
<span><span class="va">orth_te</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">orth_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are several resampling functions for these data in the <span class="pkg"><a href="https://cran.r-project.org/package=rsample">rsample</a></span> package, including: <code>group_vfold_cv()</code>, <code>group_bootstraps()</code>, and <code>group_mc_cv()</code>. For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vctrs.r-lib.org/">vctrs</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subjects in the training set: </span></span>
<span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_unique.html">vec_unique_count</a></span><span class="op">(</span><span class="va">orth_tr</span><span class="op">$</span><span class="va">Subject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">714</span><span class="op">)</span></span>
<span><span class="va">orth_rs</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">group_vfold_cv</span><span class="op">(</span><span class="va">orth_tr</span>, group <span class="op">=</span> <span class="va">Subject</span>, v <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>num_subjects <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span> <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_unique.html">vec_unique_count</a></span><span class="op">(</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html">assessment</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">Subject</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orth_rs</span></span>
<span><span class="co">#&gt; # Group 10-fold cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 × 3</span></span>
<span><span class="co">#&gt;   splits         id         num_subjects</span></span>
<span><span class="co">#&gt;   &lt;list&gt;         &lt;chr&gt;             &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 &lt;split [64/8]&gt; Resample01            2</span></span>
<span><span class="co">#&gt; 2 &lt;split [64/8]&gt; Resample02            2</span></span>
<span><span class="co">#&gt; 3 &lt;split [64/8]&gt; Resample03            2</span></span>
<span><span class="co">#&gt; 4 &lt;split [64/8]&gt; Resample04            2</span></span>
<span><span class="co">#&gt; 5 &lt;split [64/8]&gt; Resample05            2</span></span>
<span><span class="co">#&gt; 6 &lt;split [64/8]&gt; Resample06            2</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To leave a single subject out for each resample, we could have set <code>v</code> to be 18.</p>
<p><a href="https://aml4td.org/chapters/resampling.html#sec-multilevel-resampling"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-resampled-models" class="level2" data-number="10.11"><h2 data-number="10.11" class="anchored" data-anchor-id="sec-resampled-models">
<span class="header-section-number">10.11</span> Estimating Performance</h2>
<p>Now that we can create different types of resamples for our training set, how do we actually resample a model to get accurate performance statistics?</p>
<p>tidymodels contains high-level functions for this purpose, so there is typically no need to loop over rows of the resampling objects to get the data sets, train the model, etc.</p>
<p>The <code>fit_resamples()</code> function can do all of this for you. It takes a model (or workflow) in conjunction with a resampling object as inputs.</p>
<p>To demonstrate, let’s re-use the concrete data and create an object for a simple 10-fold cross-validation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">426</span><span class="op">)</span></span>
<span><span class="va">concrete_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">concrete</span>, prop <span class="op">=</span> <span class="fl">3</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">concrete_tr</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span><span class="va">concrete_te</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span></span>
<span><span class="va">concrete_rs</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">concrete_tr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s use a Cubist model for the data. It creates a set of rules from the data (derived from a regression tree) and, for each rule, creates a corresponding linear regression for the training set points covered by the rule. In the end, a sample is predicted, perhaps using multiple rules, and the average of the linear regression models is used as the prediction.</p>
<p>Usually, we use a boosting-like process called _model committees _to create an ensemble of rule sets. Instead, we will make a single rule set. We’ll need to load the <span class="pkg"><a href="https://cran.r-project.org/package=rules">rules</a></span> package to load this type of model into the <span class="pkg"><a href="https://cran.r-project.org/package=parsnip">parsnip</a></span> model database.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/rules">rules</a></span><span class="op">)</span></span>
<span><span class="va">rules_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/cubist_rules.html">cubist_rules</a></span><span class="op">(</span>committees <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To specify the model in <code>fit_resamples()</code>, there are two options:</p>
<ul>
<li>The first two arguments can be a model specification and a preprocessor (in that order). The preprocessor could be a recipe or a standard R formula.</li>
<li>The first argument can be a workflow.</li>
</ul>
<p>After the model specification, the <code>resamples</code> argument takes the resamping object.</p>
<p>From here, we can run <code>fit_resamples()</code>. Note that the Cubist model does not use any random numbers. If it did, we would probably want to set the random number seed before using <code>fit_resamples()</code>.</p>
<p>Our code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">concrete_res</span> <span class="op">&lt;-</span> <span class="fu">fit_resamples</span><span class="op">(</span><span class="va">rules_spec</span>, <span class="va">compressive_strength</span> <span class="op">~</span> <span class="va">.</span>, resamples <span class="op">=</span> <span class="va">concrete_rs</span><span class="op">)</span></span>
<span><span class="va">concrete_res</span></span>
<span><span class="co">#&gt; # Resampling results</span></span>
<span><span class="co">#&gt; # 10-fold cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 × 4</span></span>
<span><span class="co">#&gt;   splits           id     .metrics         .notes          </span></span>
<span><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;          </span></span>
<span><span class="co">#&gt; 1 &lt;split [694/78]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt;</span></span>
<span><span class="co">#&gt; 2 &lt;split [694/78]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt;</span></span>
<span><span class="co">#&gt; 3 &lt;split [695/77]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt;</span></span>
<span><span class="co">#&gt; 4 &lt;split [695/77]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt;</span></span>
<span><span class="co">#&gt; 5 &lt;split [695/77]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt;</span></span>
<span><span class="co">#&gt; 6 &lt;split [695/77]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt;</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks a lot like our resampling object. There are some new columns. <code>.metrics</code> contains data frames with performance statistics for the particular resample. The <code>.notes</code> column contains any warnings or error messages that the model produced; none were produced by these 10 model fits. Note that, if there are errors, <code>fit_resamples()</code> does not stop computations.</p>
<p>How can we get our performance estimates? To aggregate the data in this object, there is a set of <code>collect_*()</code> functions. The first is <code><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics()</a></code>. By default, it returns the averages of the resampled estimates:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">concrete_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span><span class="co">#&gt;   .metric .estimator   mean     n std_err .config             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 rmse    standard   6.503     10 0.2396  Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 2 rsq     standard   0.8517    10 0.01170 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note the <code>n</code> and <code>std_err</code> columns. To get the per-resample estimates:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">concrete_res</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 20 × 5</span></span>
<span><span class="co">#&gt;   id     .metric .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 Fold01 rmse    standard      6.764  Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 2 Fold01 rsq     standard      0.8462 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 3 Fold02 rmse    standard      6.925  Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 4 Fold02 rsq     standard      0.8044 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 5 Fold03 rmse    standard      6.652  Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 6 Fold03 rsq     standard      0.8298 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If there were issues with the computations, <code>collect_notes(concrete_res)</code> would print a catalog of messages.</p>
<p>Next, let’s look at a few customizations for <code>fit_resamples()</code>.</p>
<section id="sec-parallel-resamples" class="level3" data-number="10.11.1"><h3 data-number="10.11.1" class="anchored" data-anchor-id="sec-parallel-resamples">
<span class="header-section-number">10.11.1</span> Parallel Processing</h3>
<p>We fit 10 different Cubist models to 10 slightly different data sets. None of these computations depend on one another. This is the case of an “embarrassingly parallel” computing issue. We can increase our computational efficiency by running training the models on multiple “worker” processes on our computer(s).</p>
<p>The <code>future</code> package can run the resamples in parallel. The <code><a href="https://future.futureverse.org/reference/plan.html">plan()</a></code> function sets the parallel processing engine. There are a few plans that can be used:</p>
<ul>
<li>The most common approach is “multisession”. This uses a parallel socket cluster (akak “psock cluster”) on your local computer. It is available for all operating systems.</li>
<li>Another option (not available on Windows) is “multicore”. The forks the current R session into different worker processes.</li>
<li>The “cluster” option is most useful for having worker processes on different machines.</li>
<li>The “sequential” plan is regular, non-parallel computing.</li>
</ul>
<p>There are several other packages with plans: <span class="pkg"><a href="https://cran.r-project.org/package=future.batchtools">future.batchtools</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=future.callr">future.callr</a></span>, and <span class="pkg"><a href="https://cran.r-project.org/package=future.mirai">future.mirai</a></span>.</p>
<p>Once we know a plan, we run the following code (once) before running operations that can be done in parallel:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span></span>
<span><span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html">availableCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, the more recent mirai “engine” for parallel processing can also be used for additional efficiency.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.mirai.futureverse.org">future.mirai</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: future</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">mirai_multisession</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will generally increase the efficiency of the resampling process.</p>
</section><section id="sec-function-arguments" class="level3" data-number="10.11.2"><h3 data-number="10.11.2" class="anchored" data-anchor-id="sec-function-arguments">
<span class="header-section-number">10.11.2</span> Other Options</h3>
<p>Let’s look at some other options. First, note that the results did not include the trained models or the out-of-sample predicted results. This is the default because there is no way of knowing how much memory will be required to keep these values.</p>
<p>We’ll talk about accessing the fitted models in the next sections.</p>
<p>To save the predictions, we can use an R convention of a “control function.” These functions are reserved for specifying ancillary aspects of the computations. For <code>fit_resamples()</code> the control function is called <code>control_resamples()</code>, and it has an option called <code>save_pred</code>. When set to <code>TRUE</code>, the out-of-sample predictions are retained.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_resamples</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also estimate different metrics. As mentioned back in <a href="whole-game.html#sec-model-development-whole-game" class="quarto-xref"><span>Section 2.5</span></a>, a <em>metric set</em> is used to specify statistics for model efficacy. <code>fit_resamples()</code> has an option called <code>metrics</code> that we can use to pass in a metric set.</p>
<p>Let’s re-run our model with these two changes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reg_mtr</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">rmse</span>, <span class="va">rsq</span>, <span class="va">ccc</span>, <span class="va">mae</span><span class="op">)</span></span>
<span></span>
<span><span class="va">concrete_opts_res</span> <span class="op">&lt;-</span> <span class="fu">fit_resamples</span><span class="op">(</span></span>
<span>  <span class="va">rules_spec</span>,</span>
<span>  <span class="va">compressive_strength</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">concrete_rs</span>,</span>
<span>  metrics <span class="op">=</span> <span class="va">reg_mtr</span>,</span>
<span>  control <span class="op">=</span> <span class="va">ctrl</span></span>
<span><span class="op">)</span></span>
<span><span class="va">concrete_opts_res</span></span>
<span><span class="co">#&gt; # Resampling results</span></span>
<span><span class="co">#&gt; # 10-fold cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span><span class="co">#&gt;   splits           id     .metrics         .notes           .predictions     </span></span>
<span><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;           </span></span>
<span><span class="co">#&gt; 1 &lt;split [694/78]&gt; Fold01 &lt;tibble [4 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [78 × 4]&gt;</span></span>
<span><span class="co">#&gt; 2 &lt;split [694/78]&gt; Fold02 &lt;tibble [4 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [78 × 4]&gt;</span></span>
<span><span class="co">#&gt; 3 &lt;split [695/77]&gt; Fold03 &lt;tibble [4 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [77 × 4]&gt;</span></span>
<span><span class="co">#&gt; 4 &lt;split [695/77]&gt; Fold04 &lt;tibble [4 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [77 × 4]&gt;</span></span>
<span><span class="co">#&gt; 5 &lt;split [695/77]&gt; Fold05 &lt;tibble [4 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [77 × 4]&gt;</span></span>
<span><span class="co">#&gt; 6 &lt;split [695/77]&gt; Fold06 &lt;tibble [4 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [77 × 4]&gt;</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The expanded set of metrics:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">concrete_opts_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 6</span></span>
<span><span class="co">#&gt;   .metric .estimator   mean     n  std_err .config             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 ccc     standard   0.9198    10 0.006753 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 2 mae     standard   4.621     10 0.1657   Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 3 rmse    standard   6.503     10 0.2396   Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 4 rsq     standard   0.8517    10 0.01170  Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that there is now a column named <code>.predictions</code>. The number of rows in the tibbles matches the sizes of the assessment sets shown in the <code>splits</code> column; these are the held-out predicted values.</p>
<p>To obtain these values, there are <code><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_predictions()</a></code> and <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">heldout_pred</span> <span class="op">&lt;-</span> <span class="fu">collect_predictions</span><span class="op">(</span><span class="va">concrete_opts_res</span><span class="op">)</span></span>
<span><span class="va">heldout_pred</span></span>
<span><span class="co">#&gt; # A tibble: 772 × 5</span></span>
<span><span class="co">#&gt;   .pred id      .row compressive_strength .config             </span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;int&gt;                &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 40.56 Fold01     8                40.76 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 2 29.34 Fold01    14                29.22 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 3 32.65 Fold01    27                37.36 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 4 24.10 Fold01    38                20.73 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 5 61.61 Fold01    53                55.16 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 6 12.30 Fold01    71                 9.74 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; # ℹ 766 more rows</span></span>
<span></span>
<span><span class="co"># Same but merges them with the original training data</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">concrete_opts_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 772 × 11</span></span>
<span><span class="co">#&gt;    .pred    .resid cement blast_furnace_slag fly_ash water superplasticizer</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;              &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 45.54  -12.69     168                 42.1   163.8 121.8              5.7</span></span>
<span><span class="co">#&gt; 2 54.82   -1.131    190                190       0   228                0  </span></span>
<span><span class="co">#&gt; 3 32.77    0.07400  160                188     146   203               11  </span></span>
<span><span class="co">#&gt; 4  9.688   2.862    190.3                0     125.2 166.6              9.9</span></span>
<span><span class="co">#&gt; 5 47.36  -10.09     218.9                0     124.1 158.5             11.3</span></span>
<span><span class="co">#&gt; 6 16.93   -9.526    168.9               42.2   124.3 158.3             10.8</span></span>
<span><span class="co">#&gt; # ℹ 766 more rows</span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: coarse_aggregate &lt;dbl&gt;, fine_aggregate &lt;dbl&gt;, age &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   compressive_strength &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From here, we can do exploratory data analysis to understand where our model can be improved.</p>
<p>One other option: the <span class="pkg"><a href="https://cran.r-project.org/package=probably">probably</a></span> package has a simple interface for obtaining plots of the observed and predicted values (i.e., a regression “calibration” plot):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/probably">probably</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://probably.tidymodels.org/reference/cal_plot_regression.html">cal_plot_regression</a></span><span class="op">(</span><span class="va">concrete_opts_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="resampling_files/figure-html/reg-cal-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>Not too bad but there are fairly large outliers that seem to occur more with mixtures corresponding to larger observed outcomes.</p>
</section><section id="sec-extraction" class="level3" data-number="10.11.3"><h3 data-number="10.11.3" class="anchored" data-anchor-id="sec-extraction">
<span class="header-section-number">10.11.3</span> Extracting Results</h3>
<p>How can we get the 10 trained models? The control function has an option for <code>extract</code> that takes a user-defined function. The argument to this function (say <code>x</code>) is the fitted workflow. If you want the whole model, you can return <code>x</code>. Otherwise, we can run computations on the model and return whatever elements or statistics associated with the model that we are interested in.</p>
<p>For example, a <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> method for Cubist models will save information on the rules, the regression function for each rule, and various statistics. To get this, we need to pull the Cubist model out of the workflow and then run the tidy method on it. Here is an example of that:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">extract_rules</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html">extract_fit_engine</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we update our control object:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_resamples</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, extract <span class="op">=</span> <span class="va">extract_rules</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and pass it into <code>fit_resamples()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">concrete_ext_res</span> <span class="op">&lt;-</span> <span class="fu">fit_resamples</span><span class="op">(</span><span class="va">rules_spec</span>,</span>
<span>                                  <span class="va">compressive_strength</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                                  resamples <span class="op">=</span> <span class="va">concrete_rs</span>,</span>
<span>                                  control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span></span>
<span><span class="va">concrete_ext_res</span></span>
<span><span class="co">#&gt; # Resampling results</span></span>
<span><span class="co">#&gt; # 10-fold cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 × 6</span></span>
<span><span class="co">#&gt;   splits           id     .metrics         .notes           .extracts .predictions</span></span>
<span><span class="co">#&gt;   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;    &lt;list&gt;      </span></span>
<span><span class="co">#&gt; 1 &lt;split [694/78]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;  &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; 2 &lt;split [694/78]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;  &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; 3 &lt;split [695/77]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;  &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; 4 &lt;split [695/77]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;  &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; 5 &lt;split [695/77]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;  &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; 6 &lt;split [695/77]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;  &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The new output has an <code>.extracts</code> column. The rows contain a tibble that has the resampling information and another tibble, also with the name <code>.extracts</code>. We can pull that column out via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule_extract</span> <span class="op">&lt;-</span> <span class="fu">collect_extracts</span><span class="op">(</span><span class="va">concrete_ext_res</span><span class="op">)</span></span>
<span><span class="va">rule_extract</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 3</span></span>
<span><span class="co">#&gt;   id     .extracts         .config             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;list&gt;            &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 Fold01 &lt;tibble [10 × 5]&gt; Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 2 Fold02 &lt;tibble [13 × 5]&gt; Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 3 Fold03 &lt;tibble [13 × 5]&gt; Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 4 Fold04 &lt;tibble [11 × 5]&gt; Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 5 Fold05 &lt;tibble [13 × 5]&gt; Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; 6 Fold06 &lt;tibble [13 × 5]&gt; Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is in a specific result?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule_extract</span><span class="op">$</span><span class="va">.extracts</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span><span class="co">#&gt;   committee rule_num rule                                         estimate statistic</span></span>
<span><span class="co">#&gt;       &lt;int&gt;    &lt;int&gt; &lt;chr&gt;                                        &lt;list&gt;   &lt;list&gt;   </span></span>
<span><span class="co">#&gt; 1         1        1 ( cement &lt;= 218.89999 ) &amp; ( blast_furnace_s… &lt;tibble&gt; &lt;tibble&gt; </span></span>
<span><span class="co">#&gt; 2         1        2 ( cement &lt;= 218.89999 ) &amp; ( blast_furnace_s… &lt;tibble&gt; &lt;tibble&gt; </span></span>
<span><span class="co">#&gt; 3         1        3 ( water &gt; 183.8 ) &amp; ( cement &gt; 218.89999 ) … &lt;tibble&gt; &lt;tibble&gt; </span></span>
<span><span class="co">#&gt; 4         1        4 ( age &lt;= 7 ) &amp; ( water &lt;= 183.8 ) &amp; ( blast… &lt;tibble&gt; &lt;tibble&gt; </span></span>
<span><span class="co">#&gt; 5         1        5 ( age &lt;= 28 ) &amp; ( age &gt; 7 ) &amp; ( cement &gt; 21… &lt;tibble&gt; &lt;tibble&gt; </span></span>
<span><span class="co">#&gt; 6         1        6 ( age &gt; 28 ) &amp; ( superplasticizer &lt;= 7.8000… &lt;tibble&gt; &lt;tibble&gt; </span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To “flatten out” these results, we’ll <code>unnest()</code> the column of extracted results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule_extract</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">collect_extracts</span><span class="op">(</span><span class="va">concrete_ext_res</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span>col <span class="op">=</span> <span class="va">.extracts</span><span class="op">)</span></span>
<span><span class="va">rule_extract</span></span>
<span><span class="co">#&gt; # A tibble: 124 × 7</span></span>
<span><span class="co">#&gt;   id     committee rule_num rule                          estimate statistic .config</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt;    &lt;int&gt; &lt;chr&gt;                         &lt;list&gt;   &lt;list&gt;    &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 Fold01         1        1 ( cement &lt;= 218.89999 ) &amp; ( … &lt;tibble&gt; &lt;tibble&gt;  Prepro…</span></span>
<span><span class="co">#&gt; 2 Fold01         1        2 ( cement &lt;= 218.89999 ) &amp; ( … &lt;tibble&gt; &lt;tibble&gt;  Prepro…</span></span>
<span><span class="co">#&gt; 3 Fold01         1        3 ( water &gt; 183.8 ) &amp; ( cement… &lt;tibble&gt; &lt;tibble&gt;  Prepro…</span></span>
<span><span class="co">#&gt; 4 Fold01         1        4 ( age &lt;= 7 ) &amp; ( water &lt;= 18… &lt;tibble&gt; &lt;tibble&gt;  Prepro…</span></span>
<span><span class="co">#&gt; 5 Fold01         1        5 ( age &lt;= 28 ) &amp; ( age &gt; 7 ) … &lt;tibble&gt; &lt;tibble&gt;  Prepro…</span></span>
<span><span class="co">#&gt; 6 Fold01         1        6 ( age &gt; 28 ) &amp; ( superplasti… &lt;tibble&gt; &lt;tibble&gt;  Prepro…</span></span>
<span><span class="co">#&gt; # ℹ 118 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What could we do with these results? Let’s look at what is in the <code>statistics</code> tibble:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule_extract</span><span class="op">$</span><span class="va">statistic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   num_conditions coverage  mean   min   max error</span></span>
<span><span class="co">#&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1              3       74 22.71   7.4 55.51 4.062</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It might be interesting to know how complex each rule was. For example, the rule</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt; (water &lt;= 174.8) &amp; (cement &gt; 255.5) &amp; (blast_furnace_slag &lt;= 
#&gt;     139.89999) &amp; (age &gt; 7) &amp; (age &lt;= 56) &amp; (fly_ash &lt;= 126.5)</code></pre>
</div>
<p>has 6 conditions.</p>
<p>We can use a <code>mutate()</code> and a <code>map_int()</code> to pull out the frequency of terms included in the rules (captured by the <code>num_conditions</code> column).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">conditions</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">rule_extract</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>conditions <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">statistic</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">num_conditions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">rule_num</span>, <span class="va">conditions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the distribution of the number of logical conditions that make up the rules:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">conditions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">conditions</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   conditions     n</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1          1     7</span></span>
<span><span class="co">#&gt; 2          2    13</span></span>
<span><span class="co">#&gt; 3          3    53</span></span>
<span><span class="co">#&gt; 4          4    36</span></span>
<span><span class="co">#&gt; 5          5    14</span></span>
<span><span class="co">#&gt; 6          6     1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/tidymodels\.aml4td\.org\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/overfitting.html" class="pagination-link" aria-label="Overfitting">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Overfitting</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/grid.html" class="pagination-link" aria-label="Grid Search">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Grid Search</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>