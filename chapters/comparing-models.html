<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>14&nbsp; Comparing Models – Tidymodels Computing Supplement</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/cls-metrics.html" rel="next">
<link href="../chapters/feature-selection.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-109f5ab760e167ab0a7984bfec541ac0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-comparing-models" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Comparing Models</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../"></a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/aml4td/computing-tidymodels/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/news.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/initial-data-splitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Initial Data Splitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/missing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Missing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/numeric-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transforming Numeric Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/categorical-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with Categorical Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/embeddings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Embeddings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/interactions-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Interactions and Nonlinear Features</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Optmization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Measuring Performance with Resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/grid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Grid Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/iterative-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/feature-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/comparing-models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Comparing Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Classification</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/cls-metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Characterizing Classification Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Regression</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Characterization</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Finalization</span></span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#requirements" id="toc-requirements" class="nav-link active" data-scroll-target="#requirements"><span class="header-section-number">14.1</span> Requirements</a></li>
  <li><a href="#sec-forested-compare-setup" id="toc-sec-forested-compare-setup" class="nav-link" data-scroll-target="#sec-forested-compare-setup"><span class="header-section-number">14.2</span> Example Data</a></li>
  <li><a href="#sec-forested-model-fits" id="toc-sec-forested-model-fits" class="nav-link" data-scroll-target="#sec-forested-model-fits"><span class="header-section-number">14.3</span> Model Fitting</a></li>
  <li><a href="#sec-forested-workflow-set" id="toc-sec-forested-workflow-set" class="nav-link" data-scroll-target="#sec-forested-workflow-set"><span class="header-section-number">14.4</span> A Workflow Set</a></li>
  <li>
<a href="#sec-compare-resamples" id="toc-sec-compare-resamples" class="nav-link" data-scroll-target="#sec-compare-resamples"><span class="header-section-number">14.5</span> Resampled Data Sets</a>
  <ul class="collapse">
<li><a href="#sec-compare-stats" id="toc-sec-compare-stats" class="nav-link" data-scroll-target="#sec-compare-stats"><span class="header-section-number">14.5.1</span> Statistical Foundations</a></li>
  <li><a href="#sec-nhtm" id="toc-sec-nhtm" class="nav-link" data-scroll-target="#sec-nhtm"><span class="header-section-number">14.5.2</span> Frequentist Hypothesis Testing Methods</a></li>
  <li><a href="#sec-compare-resample-bayes" id="toc-sec-compare-resample-bayes" class="nav-link" data-scroll-target="#sec-compare-resample-bayes"><span class="header-section-number">14.5.3</span> Comparisons Using Bayesian Models</a></li>
  </ul>
</li>
  <li><a href="#sec-compare-holdout" id="toc-sec-compare-holdout" class="nav-link" data-scroll-target="#sec-compare-holdout"><span class="header-section-number">14.6</span> Single Holdout Data Sets</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-comparing-models" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Comparing Models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This book’s chapter involved taking models that have been fit or resampled and using their results to formally compare them.</p>
<section id="requirements" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="requirements">
<span class="header-section-number">14.1</span> Requirements</h2>
<p>You’ll need 14 packages (<span class="pkg"><a href="https://cran.r-project.org/package=bestNormalize">bestNormalize</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=broom.mixed">broom.mixed</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=C50">C50</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=discrim">discrim</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=embed">embed</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=glmnet">glmnet</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=klaR">klaR</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=lme4">lme4</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=multcomp">multcomp</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=rstanarm">rstanarm</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=rules">rules</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=splines2">splines2</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=tidymodels">tidymodels</a></span>, and <span class="pkg"><a href="https://cran.r-project.org/package=tidyposterior">tidyposterior</a></span>) for this chapter. You can install them via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">req_pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bestNormalize"</span>, <span class="st">"broom.mixed"</span>, <span class="st">"C50"</span>, <span class="st">"discrim"</span>, <span class="st">"embed"</span>, </span>
<span>             <span class="st">"glmnet"</span>, <span class="st">"klaR"</span>, <span class="st">"lme4"</span>, <span class="st">"multcomp"</span>, <span class="st">"rstanarm"</span>, <span class="st">"rules"</span>, <span class="st">"splines2"</span>, </span>
<span>             <span class="st">"tidymodels"</span>, <span class="st">"tidyposterior"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check to see if they are installed: </span></span>
<span><span class="va">pkg_installed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">req_pkg</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/is_installed.html">is_installed</a></span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install missing packages: </span></span>
<span><span class="kw">if</span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="op">!</span><span class="va">pkg_installed</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">install_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pkg_installed</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">pkg_installed</span><span class="op">]</span></span>
<span>  <span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html">pak</a></span><span class="op">(</span><span class="va">install_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s load the meta package and manage some between-package function conflicts. We’ll also load some packages that are used for the data analysis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Other packages that we will load below</span></span>
<span></span>
<span><span class="co"># For feature engineering:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://embed.tidymodels.org">embed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://petersonr.github.io/bestNormalize/">bestNormalize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For models:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/discrim">discrim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/rules">rules</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For Frequentist analysis:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org">multcomp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For Bayesian analysis: </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyposterior.tidymodels.org">tidyposterior</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-forested-compare-setup" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="sec-forested-compare-setup">
<span class="header-section-number">14.2</span> Example Data</h2>
<p>We’ll use the forestation data just as in the book. These data have already been split, and some interactions have been assessed. Those are captured in two remote RData files:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Loads the training and test set data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://github.com/aml4td/website/raw/refs/heads/main/RData/forested_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load information needed for interactions:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://github.com/aml4td/website/raw/refs/heads/main/RData/forested_interactions.RData"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first file contains these relevant objects:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">forested_split</span></span>
<span><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span><span class="co">#&gt; &lt;4832/1371/6203&gt;</span></span>
<span></span>
<span><span class="va">forested_train</span></span>
<span><span class="co">#&gt; # A tibble: 4,832 × 17</span></span>
<span><span class="co">#&gt;   class  year elevation eastness northness roughness dew_temp precip_annual</span></span>
<span><span class="co">#&gt; * &lt;fct&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Yes    2005       113      -25        96        30     6.4           1710</span></span>
<span><span class="co">#&gt; 2 No     2005       164      -84        53        13     6.06          1297</span></span>
<span><span class="co">#&gt; 3 Yes    2005       299       93        34         6     4.43          2545</span></span>
<span><span class="co">#&gt; 4 Yes    2005       806       47       -88        35     1.06           609</span></span>
<span><span class="co">#&gt; 5 Yes    2005       736      -27       -96        53     1.35           539</span></span>
<span><span class="co">#&gt; 6 Yes    2005       636      -48        87         3     1.42           702</span></span>
<span><span class="co">#&gt; # ℹ 4,826 more rows</span></span>
<span><span class="co">#&gt; # ℹ 9 more variables: temp_annual_mean &lt;dbl&gt;, temp_annual_min &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   temp_annual_max &lt;dbl&gt;, temp_january_min &lt;dbl&gt;, vapor_min &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   vapor_max &lt;dbl&gt;, county &lt;fct&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;</span></span>
<span></span>
<span><span class="va">forested_test</span></span>
<span><span class="co">#&gt; # A tibble: 1,371 × 17</span></span>
<span><span class="co">#&gt;   class  year elevation eastness northness roughness dew_temp precip_annual</span></span>
<span><span class="co">#&gt; * &lt;fct&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 No     2014       308      -70       -70         4     3.07           233</span></span>
<span><span class="co">#&gt; 2 No     2014       119       94        31         2     3.74           200</span></span>
<span><span class="co">#&gt; 3 No     2014       795      -74        66        39     0.17           255</span></span>
<span><span class="co">#&gt; 4 Yes    2014      1825       99        -9        78    -3.37          1241</span></span>
<span><span class="co">#&gt; 5 No     2014       126       83       -55         6     4.08           234</span></span>
<span><span class="co">#&gt; 6 Yes    2014      1056       99         7        57    -1.6            557</span></span>
<span><span class="co">#&gt; # ℹ 1,365 more rows</span></span>
<span><span class="co">#&gt; # ℹ 9 more variables: temp_annual_mean &lt;dbl&gt;, temp_annual_min &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   temp_annual_max &lt;dbl&gt;, temp_january_min &lt;dbl&gt;, vapor_min &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   vapor_max &lt;dbl&gt;, county &lt;fct&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;</span></span>
<span></span>
<span><span class="va">forested_rs</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span><span class="co">#&gt;   splits             id    </span></span>
<span><span class="co">#&gt;   &lt;list&gt;             &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 &lt;split [4127/489]&gt; Fold01</span></span>
<span><span class="co">#&gt; 2 &lt;split [4080/491]&gt; Fold02</span></span>
<span><span class="co">#&gt; 3 &lt;split [4074/505]&gt; Fold03</span></span>
<span><span class="co">#&gt; 4 &lt;split [4185/434]&gt; Fold04</span></span>
<span><span class="co">#&gt; 5 &lt;split [4116/475]&gt; Fold05</span></span>
<span><span class="co">#&gt; 6 &lt;split [4049/523]&gt; Fold06</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second file has this important formula object that contains what we think are important interactions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">forested_int_form</span></span>
<span><span class="co">#&gt; ~dew_temp:elevation + dew_temp:temp_annual_max + dew_temp:temp_january_min + </span></span>
<span><span class="co">#&gt;     eastness:vapor_max + temp_annual_max:vapor_max</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-forested-model-fits" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="sec-forested-model-fits">
<span class="header-section-number">14.3</span> Model Fitting</h2>
<p>We’ll need to resample a few models. We’ll cut to the chase and resample the tuning parameters found to be optimal in the regular text.</p>
<p>First, we load some additional packages and create some preliminaries:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For resampling the models</span></span>
<span><span class="va">ctrl_rs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">control_resamples</span><span class="op">(</span></span>
<span>    save_pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    parallel_over <span class="op">=</span> <span class="st">"everything"</span>,</span>
<span>    save_workflow <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># Keep this for as_workflow_set()</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cls_mtr</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We start by resampling the boosted tree with the tuning parameter values that were found during the grid search:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">boost_spec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/C5_rules.html">C5_rules</a></span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">60</span>, min_n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"C5.0"</span>, control <span class="op">=</span> <span class="fu">C50</span><span class="fu">::</span><span class="fu"><a href="https://topepo.github.io/C5.0/reference/C5.0Control.html">C5.0Control</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">864</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boost_wflow</span> <span class="op">&lt;-</span>  <span class="fu">workflow</span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">boost_spec</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">526</span><span class="op">)</span></span>
<span><span class="va">boost_res</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fit_resamples</span><span class="op">(</span></span>
<span>    <span class="va">boost_wflow</span>,</span>
<span>    resamples <span class="op">=</span> <span class="va">forested_rs</span>,</span>
<span>    control <span class="op">=</span> <span class="va">ctrl_rs</span>,</span>
<span>    metrics <span class="op">=</span> <span class="va">cls_mtr</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the individual resamples and change the name of the accuracy column. </span></span>
<span><span class="va">boost_metrics</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">boost_res</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, Boosting <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although we strive for reproducibility, it can be difficult. The boosted tree results from the main text (where it was tuned) used slightly different random numbers than when we trained for a single model. Nine of the ten resamples had different accuracy results; the mean difference between the two was 0.07%, and the largest difference was 0.84%. This is obviously very small, but it does lead to different results here than in the main text. The conclusions will not change.</p>
</div>
</div>
<p>Now let’s create the logistic regression. There is a fair amount of preprocessing and feature engineering. The rationale for these will be discussed in a future chapter in Part 4.</p>
<p>You’ll see below that, although the model uses a single penalty value, we <a href="https://parsnip.tidymodels.org/reference/glmnet-details.html">pass a sequence of penalties</a> to the <code>lambda</code> parameter of <code><a href="https://glmnet.stanford.edu/reference/glmnet.html">glmnet::glmnet()</a></code>. See <a href="https://github.com/tidymodels/parsnip/issues/431#issuecomment-782883848">parsnip issue #431</a> for some background.</p>
<p>The model is a full ridge regression model since <code>mixture = 0</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">logistic_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">forested_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># standardize numeric predictors</span></span>
<span>  <span class="fu"><a href="https://petersonr.github.io/bestNormalize/reference/step_orderNorm.html">step_orderNorm</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Convert to an effect encoding</span></span>
<span>  <span class="fu"><a href="https://embed.tidymodels.org/reference/step_lencode_mixed.html">step_lencode_mixed</a></span><span class="op">(</span><span class="va">county</span>, outcome <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Create pre-defined interactions</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html">step_interact</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">forested_int_form</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># 10 spline terms for certain predictors</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_spline_natural.html">step_spline_natural</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="op">-</span><span class="va">county</span>,</span>
<span>    <span class="op">-</span><span class="va">eastness</span>,</span>
<span>    <span class="op">-</span><span class="va">northness</span>,</span>
<span>    <span class="op">-</span><span class="va">year</span>,</span>
<span>    <span class="op">-</span><span class="fu">contains</span><span class="op">(</span><span class="st">"_x_"</span><span class="op">)</span>,</span>
<span>    deg_free <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Remove any linear dependencies</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_lincomb.html">step_lincomb</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ------------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">logistic_pen</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logistic_spec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="co"># Values here were determined via grid search:</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html">logistic_reg</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">2.12095088792019e-05</span>, mixture <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"glmnet"</span>, path_values <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">logistic_pen</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ------------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">logistic_wflow</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="va">logistic_rec</span>, <span class="va">logistic_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logistic_res</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">logistic_wflow</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit_resamples</span><span class="op">(</span></span>
<span>    resamples <span class="op">=</span> <span class="va">forested_rs</span>,</span>
<span>    control <span class="op">=</span> <span class="va">ctrl_rs</span>,</span>
<span>    metrics <span class="op">=</span> <span class="va">cls_mtr</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">logistic_metrics</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">logistic_res</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, Logistic <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the naive Bayes model. There is no need for feature engineering and not much in the way of tuning parameters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nb_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">forested_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://petersonr.github.io/bestNormalize/reference/step_orderNorm.html">step_orderNorm</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nb_wflow</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="va">nb_rec</span>, <span class="fu"><a href="https://parsnip.tidymodels.org/reference/naive_Bayes.html">naive_Bayes</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nb_res</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">nb_wflow</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit_resamples</span><span class="op">(</span></span>
<span>    resamples <span class="op">=</span> <span class="va">forested_rs</span>,,</span>
<span>    control <span class="op">=</span> <span class="va">ctrl_rs</span>,</span>
<span>    metrics <span class="op">=</span> <span class="va">cls_mtr</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">nb_metrics</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">nb_res</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, `Naive Bayes` <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>During resampling, this model will probably provide some warnings when fit that resemble:</p>
<blockquote class="blockquote">
<p>Numerical 0 probability for all classes with observation X</p>
</blockquote>
<p>This occurs because the model multiplies about a dozen probabilities together. The consequence is that some of these products become very close to zero, and R complains a bit about this.</p>
</section><section id="sec-forested-workflow-set" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="sec-forested-workflow-set">
<span class="header-section-number">14.4</span> A Workflow Set</h2>
<p>Another method for resampling or tuning a series of preprocessors and/or models is to create a <em>workflow set</em>. We’ll see these more in later chapters. Let’s take our previous set of three model results and coerce them into a workflow set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">forested_wflow_set</span> <span class="op">&lt;-</span> <span class="fu">as_workflow_set</span><span class="op">(</span></span>
<span>    Boosting <span class="op">=</span> <span class="va">boost_res</span>,</span>
<span>    Logistic <span class="op">=</span> <span class="va">logistic_res</span>,</span>
<span>    `Naive Bayes` <span class="op">=</span> <span class="va">nb_res</span></span>
<span><span class="op">)</span></span>
<span><span class="va">forested_wflow_set</span></span>
<span><span class="co">#&gt; # A workflow set/tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   wflow_id    info             option    result   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   </span></span>
<span><span class="co">#&gt; 1 Boosting    &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 2 Logistic    &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 3 Naive Bayes &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;rsmp[+]&gt;</span></span>
<span></span>
<span><span class="va">forested_wflow_set</span> <span class="op">|&gt;</span> <span class="fu">rank_results</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 9</span></span>
<span><span class="co">#&gt;   wflow_id    .config         .metric   mean  std_err     n preprocessor model  rank</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting    Preprocessor1_… accura… 0.8952 0.009321    10 formula      C5_r…     1</span></span>
<span><span class="co">#&gt; 2 Logistic    Preprocessor1_… accura… 0.8906 0.01038     10 recipe       logi…     2</span></span>
<span><span class="co">#&gt; 3 Naive Bayes Preprocessor1_… accura… 0.8581 0.01542     10 recipe       naiv…     3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll see the advantage of this in a later section.</p>
</section><section id="sec-compare-resamples" class="level2" data-number="14.5"><h2 data-number="14.5" class="anchored" data-anchor-id="sec-compare-resamples">
<span class="header-section-number">14.5</span> Resampled Data Sets</h2>
<p>Let’s collect the accuracy values for each resample and model into a data frame. We’ll make a “wide” version with three columns for each of the three models and a “long” version where there is a column for each model and another for the accuracies. We call the column with the model <code>pipeline</code>.</p>
<p>We’ll also plot the data to show that it is similar to the one in the main text.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">accuracy_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">boost_metrics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">full_join</span><span class="op">(</span><span class="va">logistic_metrics</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">full_join</span><span class="op">(</span><span class="va">nb_metrics</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> </span>
<span><span class="va">accuracy_df</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 4</span></span>
<span><span class="co">#&gt;   id     Boosting Logistic `Naive Bayes`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Fold01   0.8671   0.8773        0.8057</span></span>
<span><span class="co">#&gt; 2 Fold02   0.8900   0.8839        0.8310</span></span>
<span><span class="co">#&gt; 3 Fold03   0.9485   0.9505        0.9386</span></span>
<span><span class="co">#&gt; 4 Fold04   0.8687   0.8848        0.8618</span></span>
<span><span class="co">#&gt; 5 Fold05   0.8589   0.8653        0.8547</span></span>
<span><span class="co">#&gt; 6 Fold06   0.8776   0.8413        0.7820</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span>
<span>  </span>
<span><span class="va">accuracy_long_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">accuracy_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"pipeline"</span>, values_to <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span></span>
<span><span class="va">accuracy_long_df</span></span>
<span><span class="co">#&gt; # A tibble: 30 × 3</span></span>
<span><span class="co">#&gt;   id     pipeline    accuracy</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Fold01 Boosting      0.8671</span></span>
<span><span class="co">#&gt; 2 Fold01 Logistic      0.8773</span></span>
<span><span class="co">#&gt; 3 Fold01 Naive Bayes   0.8057</span></span>
<span><span class="co">#&gt; 4 Fold02 Boosting      0.8900</span></span>
<span><span class="co">#&gt; 5 Fold02 Logistic      0.8839</span></span>
<span><span class="co">#&gt; 6 Fold02 Naive Bayes   0.8310</span></span>
<span><span class="co">#&gt; # ℹ 24 more rows</span></span>
<span></span>
<span><span class="va">accuracy_long_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">pipeline</span>, <span class="va">accuracy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">id</span>, col <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>label <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="comparing-models_files/figure-html/collect-resamples-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now we can start analyzing the data in different ways.</p>
<section id="sec-compare-stats" class="level3" data-number="14.5.1"><h3 data-number="14.5.1" class="anchored" data-anchor-id="sec-compare-stats">
<span class="header-section-number">14.5.1</span> Statistical Foundations</h3>
<p>We’ll start with the Frequentist perspective.</p>
</section><section id="sec-nhtm" class="level3" data-number="14.5.2"><h3 data-number="14.5.2" class="anchored" data-anchor-id="sec-nhtm">
<span class="header-section-number">14.5.2</span> Frequentist Hypothesis Testing Methods</h3>
<p>We take the wide version of the accuracy data and fit a linear regression to it in a way that accounts for the resample-to-resample effect. Let’s take a minute and think about how our model will set up the parameter estimates.</p>
<p>Since the data in the <code>pipeline</code> column is currently character, the model function will convert this column to a factor and assign the factor level order alphabetically. This means that the levels are: <code>Boosting</code>, <code>Logistic</code>, and <code>Naive Bayes</code>. Recall that the default parameterization for indicator variables is a “reference cell” parameterization, so the intercept corresponds to the first factor level. This means that, in terms of the fixed effects, we interpret parameter estimates as:</p>
<p><span class="math display">\[
\hat{y}_{ij} = \underbrace{\quad \hat{\beta}_0\quad }_{\tt{Boosting}} + \underbrace{\quad \hat{\beta}_1 \quad }_{\tt{Boosting - Logistic}} +\underbrace{\quad \hat{\beta}_2\quad }_{\tt{Boosting - Naive\: Bayes}}
\]</span></p>
<p>Using <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer()</a></code> to fit the model, we specify <code>pipeline</code> as the fixed effect and designate a random effect due to resampling as <code>(1|id)</code>, where <code>1</code> symbolizes the intercept.</p>
<p>The results are:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_mixed_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">accuracy</span> <span class="op">~</span> <span class="va">pipeline</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">accuracy_long_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">freq_mixed_mod</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span><span class="co">#&gt;   effect   group    term                 estimate std.error statistic</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 fixed    &lt;NA&gt;     (Intercept)          0.8952    0.01200    74.57  </span></span>
<span><span class="co">#&gt; 2 fixed    &lt;NA&gt;     pipelineLogistic    -0.004504  0.007520   -0.5989</span></span>
<span><span class="co">#&gt; 3 fixed    &lt;NA&gt;     pipelineNaive Bayes -0.03702   0.007520   -4.922 </span></span>
<span><span class="co">#&gt; 4 ran_pars id       sd__(Intercept)      0.03403  NA          NA     </span></span>
<span><span class="co">#&gt; 5 ran_pars Residual sd__Observation      0.01682  NA          NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model term corresponding to <code>term = "sd__(Intercept)"</code> is the standard deviation of the random effects, and the one with a <code>term</code> value of <code>sd__Observation</code> is the residual standard deviation. Note that the former is almost twice the size of the latter; the resample-to-resample effect is <em>very</em> large for these data.</p>
<p>Notice that p-values that are <em>not</em> automatically computed. This is addressed by reading <code><a href="https://rdrr.io/pkg/lme4/man/pvalues.html">help("pvalues")</a></code> or the package vignette called “Fitting Linear Mixed-Effects Models using lme4”. The CRAN PDF for the latter is <a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf">here</a>. We can create approximate p-values using the <span class="pkg"><a href="https://cran.r-project.org/package=lmerTest">lmerTest</a></span> or <span class="pkg"><a href="https://cran.r-project.org/package=multicomp">multicomp</a></span> packages.</p>
<p>We’ll show the <span class="pkg"><a href="https://cran.r-project.org/package=multicomp">multicomp</a></span> package but first we will define contrasts of the parameter estimates that provide all three pairwise comparisons.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Coefficients for the estimates to create differences in accuracies.</span></span>
<span><span class="va">comparisons</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="st">"Boosting - Logistic"</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">1</span>,  <span class="fl">0</span><span class="op">)</span>,     </span>
<span>        <span class="st">"Boosting - Naive Bayes"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">0</span>,  <span class="fl">1</span><span class="op">)</span>,     </span>
<span>        <span class="st">"Naive Bayes - Logistic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>,  <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use the <code><a href="https://rdrr.io/pkg/multcomp/man/glht.html">multcomp::glht()</a></code> function<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> to generate them. The <code><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht()</a></code> function relies on another function from that package called <code><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp()</a></code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, and that can be used to sort out the details. For the raw (but approximate) p-values, we simply give it a single contrast at a time:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">raw_res</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">raw_res</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>      <span class="va">raw_res</span>, </span>
<span>      <span class="va">freq_mixed_mod</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span>linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>pipeline <span class="op">=</span> <span class="va">comparisons</span><span class="op">[</span><span class="va">i</span>,,drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">rename</span><span class="op">(</span>raw_pvalue <span class="op">=</span> <span class="va">adj.p.value</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">raw_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">term</span>, <span class="op">-</span><span class="va">null.value</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   contrast                estimate std.error statistic   raw_pvalue</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting - Logistic    -0.004504  0.007520   -0.5989 0.5493      </span></span>
<span><span class="co">#&gt; 2 Boosting - Naive Bayes -0.03702   0.007520   -4.922  0.0000008554</span></span>
<span><span class="co">#&gt; 3 Naive Bayes - Logistic -0.03251   0.007520   -4.323  0.00001536</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, due to differences in random numbers, the accuracy numbers are slightly different. Consequently, the p-values are also different in value but not in interpretation.</p>
<p><a href="https://aml4td.org/chapters/comparing-models.html#sec-nhtm"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
<section id="sec-post-hoc" class="level4" data-number="14.5.2.1"><h4 data-number="14.5.2.1" class="anchored" data-anchor-id="sec-post-hoc">
<span class="header-section-number">14.5.2.1</span> Post Hoc Pairwise Comparisons and Protecting Against False Positive Findings</h4>
<p>To compute the Bonferroni or FDR adjustments, we can use the <code><a href="https://rdrr.io/r/stats/p.adjust.html">stats::p.adjust()</a></code> package. However, for the FDR, there are <em>many</em> alternatives. In CRAN alone:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/CRANtools.html">CRAN_package_db</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"(fdr)|(false discovery rate)"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">Description</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\n"</span>, <span class="st">""</span>, <span class="va">Title</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Package</span>, <span class="va">Title</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 85 × 2</span></span>
<span><span class="co">#&gt;   Package             Title                                                         </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;                                                         </span></span>
<span><span class="co">#&gt; 1 adaptMT             Adaptive P-Value Thresholding for Multiple Hypothesis Testing…</span></span>
<span><span class="co">#&gt; 2 alpha.correction.bh Benjamini-Hochberg Alpha Correction                           </span></span>
<span><span class="co">#&gt; 3 APFr                Multiple Testing Approach using Average Power Function (APF) …</span></span>
<span><span class="co">#&gt; 4 ashr                Methods for Adaptive Shrinkage, using Empirical Bayes         </span></span>
<span><span class="co">#&gt; 5 bayefdr             Bayesian Estimation and Optimisation of Expected False Discov…</span></span>
<span><span class="co">#&gt; 6 BonEV               An Improved Multiple Testing Procedure for Controlling FalseD…</span></span>
<span><span class="co">#&gt; # ℹ 79 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and even more on <a href="https://bioconductor.org/">Bioconductor</a>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/available.html">available</a></span><span class="op">(</span><span class="st">"(fdr)|(false discovery rate)"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bayefdr"              "benchmarkfdrData2019" "cffdrs"              </span></span>
<span><span class="co">#&gt;  [4] "CorrectedFDR"         "dfdr"                 "DiscreteFDR"         </span></span>
<span><span class="co">#&gt;  [7] "EFDR"                 "fcfdr"                "fdrame"              </span></span>
<span><span class="co">#&gt; [10] "fdrci"                "fdrDiscreteNull"      "FDRestimation"       </span></span>
<span><span class="co">#&gt; [13] "FDRsamplesize2"       "FDRsampsize"          "fdrtool"             </span></span>
<span><span class="co">#&gt; [16] "GFDrmst"              "GFDrmtl"              "LFDR.MLE"            </span></span>
<span><span class="co">#&gt; [19] "LFDR.MME"             "LFDREmpiricalBayes"   "locfdr"              </span></span>
<span><span class="co">#&gt; [22] "nzffdr"               "onlineFDR"            "pafdR"               </span></span>
<span><span class="co">#&gt; [25] "pwrFDR"               "repfdr"               "RFlocalfdr"          </span></span>
<span><span class="co">#&gt; [28] "RFlocalfdr.data"      "sffdr"                "simpleFDR"           </span></span>
<span><span class="co">#&gt; [31] "SNVLFDR"              "ssize.fdr"            "swfdr"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/stats/p.adjust.html">stats::p.adjust()</a></code> is very simple to use:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">raw_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    Bonnferoni <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">raw_pvalue</span>, method <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span>,</span>
<span>    FDR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">raw_pvalue</span>, method <span class="op">=</span> <span class="st">"BH"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">term</span>, <span class="op">-</span><span class="va">null.value</span>, <span class="op">-</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span><span class="co">#&gt;   contrast               std.error statistic   raw_pvalue  Bonnferoni         FDR</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting - Logistic     0.007520   -0.5989 0.5493       1           0.5493     </span></span>
<span><span class="co">#&gt; 2 Boosting - Naive Bayes  0.007520   -4.922  0.0000008554 0.000002566 0.000002566</span></span>
<span><span class="co">#&gt; 3 Naive Bayes - Logistic  0.007520   -4.323  0.00001536   0.00004609  0.00002304</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For Tukey’s HSD, we can use <code><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht()</a></code> again:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_mixed_mod</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span>linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>pipeline <span class="op">=</span> <span class="st">"Tukey"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">term</span>, <span class="op">-</span><span class="va">null.value</span>, <span class="op">-</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   contrast               std.error statistic adj.p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Logistic - Boosting     0.007520   -0.5989 0.8207     </span></span>
<span><span class="co">#&gt; 2 Naive Bayes - Boosting  0.007520   -4.922  0.000002667</span></span>
<span><span class="co">#&gt; 3 Naive Bayes - Logistic  0.007520   -4.323  0.00004223</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://aml4td.org/chapters/comparing-models.html#sec-post-hoc"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section><section id="sec-comparing-equivalence" class="level4" data-number="14.5.2.2"><h4 data-number="14.5.2.2" class="anchored" data-anchor-id="sec-comparing-equivalence">
<span class="header-section-number">14.5.2.2</span> Comparing Performance using Equivalence Tests</h4>
<p>We’ll conduct the Two One-Sided Test (TOST) procedure by computing the confidence intervals on the differences, which we can compute via <code><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht()</a></code> with the Tukey correction:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The defaults that mcp() uses has the opposite order from the books' main</span></span>
<span><span class="co"># test uses (e.g. Logistic - Boosting instead of Boosting - Logistic)</span></span>
<span><span class="va">difference_int</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">freq_mixed_mod</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span>linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>pipeline <span class="op">=</span> <span class="st">"Tukey"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From these data, we can create the same plot as the main text:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">difference_int</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">contrast</span>, y <span class="op">=</span> <span class="op">-</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="op">-</span><span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="op">-</span><span class="va">conf.high</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.03</span>, <span class="fl">0.03</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="op">-</span><span class="fl">0.07</span>, <span class="fl">0.07</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Comparison"</span>, y <span class="op">=</span> <span class="st">"Accuracy Difference"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>label <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="comparing-models_files/figure-html/TOST-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p><a href="https://aml4td.org/chapters/comparing-models.html#sec-comparing-equivalence"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section></section><section id="sec-compare-resample-bayes" class="level3" data-number="14.5.3"><h3 data-number="14.5.3" class="anchored" data-anchor-id="sec-compare-resample-bayes">
<span class="header-section-number">14.5.3</span> Comparisons Using Bayesian Models</h3>
<p>For Bayesian evaluation, tidymodels replies heavily on the <span class="pkg"><a href="https://cran.r-project.org/package=rstanarm">rstanarm</a></span> package, which is based on <a href="https://mc-stan.org/">Stan</a>. The <span class="pkg"><a href="https://cran.r-project.org/package=tidyposterior">tidyposterior</a></span> package is the main interface for tidymodels objects. The main function, <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">tidyposterior::perf_mod()</a></code>, has methods for several types of objects. First, we’ll show how to use it with a basic data frame of results, then with specific types of tidymodels objects.</p>
<p>When the resampled performance estimates are in a data frame, it should be in the “wide” format, such as <code>accuracy_df</code>. The simplest use of the function is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span>
<span><span class="va">basic_bayes_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod</a></span><span class="op">(</span><span class="va">accuracy_df</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">basic_bayes_mod</span></span>
<span><span class="co">#&gt; Bayesian Analysis of Resampling Results</span></span>
<span></span>
<span><span class="co"># The underlying Stan model: </span></span>
<span><span class="va">basic_bayes_mod</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pluck</span><span class="op">(</span><span class="st">"stan"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; stan_glmer</span></span>
<span><span class="co">#&gt;  family:       gaussian [identity]</span></span>
<span><span class="co">#&gt;  formula:      statistic ~ model + (1 | id)</span></span>
<span><span class="co">#&gt;  observations: 30</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt;                  Median MAD_SD</span></span>
<span><span class="co">#&gt; (Intercept)       0.895  0.011</span></span>
<span><span class="co">#&gt; modelLogistic    -0.004  0.008</span></span>
<span><span class="co">#&gt; modelNaive Bayes -0.037  0.008</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Auxiliary parameter(s):</span></span>
<span><span class="co">#&gt;       Median MAD_SD</span></span>
<span><span class="co">#&gt; sigma 0.018  0.003 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error terms:</span></span>
<span><span class="co">#&gt;  Groups   Name        Std.Dev.</span></span>
<span><span class="co">#&gt;  id       (Intercept) 0.03491 </span></span>
<span><span class="co">#&gt;  Residual             0.01857 </span></span>
<span><span class="co">#&gt; Num. levels: id 10 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; * For help interpreting the printed output see ?print.stanreg</span></span>
<span><span class="co">#&gt; * For info on the priors used see ?prior_summary.stanreg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span class="pkg"><a href="https://cran.r-project.org/package=broom.mixed">broom.mixed</a></span> package’s <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> method can also be used:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">basic_bayes_mod</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pluck</span><span class="op">(</span><span class="st">"stan"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 4</span></span>
<span><span class="co">#&gt;   term                     estimate std.error group   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   </span></span>
<span><span class="co">#&gt; 1 (Intercept)              0.8950    0.01146  &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; 2 modelLogistic           -0.004410  0.008247 &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; 3 modelNaive Bayes        -0.03717   0.008039 &lt;NA&gt;    </span></span>
<span><span class="co">#&gt; 4 sd_(Intercept).id        0.03491  NA        id      </span></span>
<span><span class="co">#&gt; 5 sd_Observation.Residual  0.01857  NA        Residual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="pkg"><a href="https://cran.r-project.org/package=tidyposterior">tidyposterior</a></span> also has a <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> method for obtaining a sample from the posterior that has been configured not to be in the format of the parameters but in terms of the model means.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">185</span><span class="op">)</span></span>
<span><span class="va">basic_bayes_post</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">basic_bayes_mod</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">basic_bayes_post</span></span>
<span><span class="co">#&gt; # Posterior samples of performance</span></span>
<span><span class="co">#&gt; # A tibble: 12,000 × 2</span></span>
<span><span class="co">#&gt;   model       posterior</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting       0.8913</span></span>
<span><span class="co">#&gt; 2 Logistic       0.9014</span></span>
<span><span class="co">#&gt; 3 Naive Bayes    0.8676</span></span>
<span><span class="co">#&gt; 4 Boosting       0.9014</span></span>
<span><span class="co">#&gt; 5 Logistic       0.9074</span></span>
<span><span class="co">#&gt; 6 Naive Bayes    0.8636</span></span>
<span><span class="co">#&gt; # ℹ 11,994 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This object also has a summary object to get credible intervals:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">basic_bayes_post</span>,  prob <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   model         mean  lower  upper</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting    0.8949 0.8749 0.9156</span></span>
<span><span class="co">#&gt; 2 Logistic    0.8905 0.8700 0.9113</span></span>
<span><span class="co">#&gt; 3 Naive Bayes 0.8579 0.8370 0.8782</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and an <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">basic_bayes_post</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="comparing-models_files/figure-html/tp-autoplot-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>To take a look at pairwise differences, there is <code><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">tidyposterior::contrast_models()</a></code>. This takes the objects produced by <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> and two vector arguments of groups to compare. If these two group arguments are left to their defaults, all comparisons are used:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">185</span><span class="op">)</span></span>
<span><span class="va">basic_bayes_diff_post</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">basic_bayes_mod</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">contrast_models</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">basic_bayes_diff_post</span></span>
<span><span class="co">#&gt; # Posterior samples of performance differences</span></span>
<span><span class="co">#&gt; # A tibble: 12,000 × 4</span></span>
<span><span class="co">#&gt;   difference model_1  model_2  contrast             </span></span>
<span><span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                </span></span>
<span><span class="co">#&gt; 1 -0.01012   Boosting Logistic Boosting vs. Logistic</span></span>
<span><span class="co">#&gt; 2 -0.005995  Boosting Logistic Boosting vs. Logistic</span></span>
<span><span class="co">#&gt; 3 -0.005884  Boosting Logistic Boosting vs. Logistic</span></span>
<span><span class="co">#&gt; 4  0.0002408 Boosting Logistic Boosting vs. Logistic</span></span>
<span><span class="co">#&gt; 5  0.002266  Boosting Logistic Boosting vs. Logistic</span></span>
<span><span class="co">#&gt; 6  0.01333   Boosting Logistic Boosting vs. Logistic</span></span>
<span><span class="co">#&gt; # ℹ 11,994 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is an <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method, but the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method is more interesting since that is where the ROPE analysis can be conducted. Using default arguments gives the 90% credible intervals on the differences:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">basic_bayes_diff_post</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 9</span></span>
<span><span class="co">#&gt;   contrast        probability     mean     lower   upper  size pract_neg pract_equiv</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting vs Lo…      0.6992 0.004403 -0.009418 0.01798     0        NA          NA</span></span>
<span><span class="co">#&gt; 2 Boosting vs Na…      1      0.03701   0.02354  0.05048     0        NA          NA</span></span>
<span><span class="co">#&gt; 3 Logistic vs Na…      0.9998 0.03260   0.01831  0.04643     0        NA          NA</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: pract_pos &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the <code>size</code> argument enables a ROPE analysis:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">basic_bayes_diff_post</span>, size <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">contrast</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   contrast                pract_neg pract_equiv pract_pos</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting vs Logistic       0.0005      0.9962   0.00325</span></span>
<span><span class="co">#&gt; 2 Boosting vs Naive Bayes    0           0.1892   0.8108 </span></span>
<span><span class="co">#&gt; 3 Logistic vs Naive Bayes    0           0.372    0.628</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are an abundance of options that can be used with <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>, including:</p>
<ul>
<li><p>The <code>transform</code> argument can convert the metric to a different scale before the analysis and back transforms when creating posteriors. For example, if you believe that <span class="math inline">\(log(RMSE)\)</span> should be used in the analysis, use this argument.</p></li>
<li><p>When we think that the probability distributions of the metrics have different variances, the <code>hetero_var</code> is logical and can enable that. Be aware that this option makes the model fit more complex, which may result in convergence issues.</p></li>
<li><p>Set Stan’s random number seed using the <code>seed</code> argument.</p></li>
</ul>
<p>There are also options that can be passed to the Stan fit, including:</p>
<ul>
<li>Sampling-related options such as <code>chains</code> (number of MCMC chains) and <code>cores</code> (how many things to do in parallel).</li>
<li>Prior distributions for parameters. Of interest might be:
<ul>
<li>
<code>prior_aux</code>: the prior for the distribution’s scale parameter (e.g.&nbsp;<span class="math inline">\(\sigma\)</span> for the Gaussian).</li>
<li>
<code>prior_intercept</code>: the distribution for the random intercepts.</li>
<li>
<code>prior</code>: distributions for the regression parameters.</li>
</ul>
</li>
</ul>
<p>For priors, the <a href="https://mc-stan.org/rstanarm/reference/priors.html">Stan page on priors</a> is important to read since it details how the default priors are automatically scaled. The <a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html">page on sampling</a> is also very helpful.</p>
<p>Finally, you can use <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> with other types of tidymodels objects. For example, if you want to conduct a <em>within-model</em> analysis where you compare candidates (say from a grid search), you can pass that as the first argument to <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>.</p>
<p>If you have a workflow set, you can perform within- and/or between-model comparisons. This can potentially compare a large number of model/candidate combinations.</p>
<p>We previously created <code>forested_wflow_set</code> to house our resampling results. Here is how we could use that object for the analysis:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">forested_wflow_set</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod</a></span><span class="op">(</span></span>
<span>    seed <span class="op">=</span> <span class="fl">310</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    chains <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    <span class="co"># Don't print a log:</span></span>
<span>    refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    prior_aux <span class="op">=</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">exponential</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">accuracy_long_df</span><span class="op">$</span><span class="va">accuracy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    prior_intercept <span class="op">=</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">cauchy</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">contrast_models</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">contrast</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   contrast                pract_neg pract_equiv pract_pos</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting vs Logistic       0.0003      0.9971   0.00264</span></span>
<span><span class="co">#&gt; 2 Boosting vs Naive Bayes    0           0.1941   0.8059 </span></span>
<span><span class="co">#&gt; 3 Logistic vs Naive Bayes    0           0.3749   0.6251</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://aml4td.org/chapters/comparing-models.html#sec-compare-resample-bayes"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>
</section></section><section id="sec-compare-holdout" class="level2" data-number="14.6"><h2 data-number="14.6" class="anchored" data-anchor-id="sec-compare-holdout">
<span class="header-section-number">14.6</span> Single Holdout Data Sets</h2>
<p>For bootstrap confidence intervals, there is a helper function <code><a href="https://rsample.tidymodels.org/reference/int_pctl.html">rsample::int_pctl()</a></code> that has methods that can work for resampled objects (e.g., <code><a href="https://tune.tidymodels.org/reference/fit_resamples.html">tune::fit_resamples()</a></code>) and the outputs from the various <code>tune_*()</code> functions.</p>
<p>As an example, <em>if</em> we were using a validation set, we could produce the 90% bootstrap interval for the model via:</p>
<div class="cell" data-layout-align="center" data-mesage="false">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">int_pctl</span><span class="op">(</span><span class="va">boost_res</span>, times <span class="op">=</span> <span class="fl">2000</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, this will compute intervals for every tuning parameter candidate and metric in the data (but there are arguments that can be used to restrict the computations to a smaller set).</p>
<p>For a test set, we encourage users to use <code>last_fit()</code>. Let’s suppose that we still can’t decide if the boosted tree or logistic regression is the final model. We can fit them and evaluate their test set via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">boost_final_res</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">last_fit</span><span class="op">(</span><span class="va">boost_wflow</span>, split <span class="op">=</span> <span class="va">forested_split</span>, metrics <span class="op">=</span> <span class="va">cls_mtr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logistic_final_res</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">last_fit</span><span class="op">(</span><span class="va">logistic_wflow</span>, split <span class="op">=</span> <span class="va">forested_split</span>, metrics <span class="op">=</span> <span class="va">cls_mtr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>then use:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">885</span><span class="op">)</span></span>
<span><span class="fu">int_pctl</span><span class="op">(</span><span class="va">boost_final_res</span>, times <span class="op">=</span> <span class="fl">2000</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   .metric  .estimator .lower .estimate .upper .config             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 accuracy bootstrap  0.8651    0.8795 0.8942 Preprocessor1_Model1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">885</span><span class="op">)</span></span>
<span><span class="fu">int_pctl</span><span class="op">(</span><span class="va">logistic_final_res</span>, times <span class="op">=</span> <span class="fl">2000</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   .metric  .estimator .lower .estimate .upper .config             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 accuracy bootstrap  0.8578    0.8730 0.8877 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To compute intervals on differences, there is no current interface. However, you can use the core functions to get the results. For example, we can join the predictions for different models by their row number:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paired_class_pred</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">logistic_final_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">collect_predictions</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">.row</span>, <span class="va">class</span>, logistic <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">full_join</span><span class="op">(</span></span>
<span>    <span class="va">boost_final_res</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">collect_predictions</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">select</span><span class="op">(</span><span class="va">.row</span>, boosting <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">".row"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">paired_class_pred</span></span>
<span><span class="co">#&gt; # A tibble: 1,371 × 4</span></span>
<span><span class="co">#&gt;    .row class logistic boosting</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt;   </span></span>
<span><span class="co">#&gt; 1  4833 No    No       No      </span></span>
<span><span class="co">#&gt; 2  4834 No    No       No      </span></span>
<span><span class="co">#&gt; 3  4835 No    No       No      </span></span>
<span><span class="co">#&gt; 4  4836 Yes   Yes      Yes     </span></span>
<span><span class="co">#&gt; 5  4837 No    No       No      </span></span>
<span><span class="co">#&gt; 6  4838 Yes   Yes      Yes     </span></span>
<span><span class="co">#&gt; # ℹ 1,365 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>then create bootstrap samples:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">649</span><span class="op">)</span></span>
<span><span class="va">paired_class_bt</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">paired_class_pred</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bootstraps</span><span class="op">(</span>times <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can write a function to get the difference:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">metric_diff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">split</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get the bootstrap sample:</span></span>
<span>  <span class="va">est</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">split</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html">analysis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># Stack the rows</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">.row</span>, <span class="op">-</span><span class="va">class</span><span class="op">)</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"model"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"estimate"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">estimate</span><span class="op">)</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>term <span class="op">=</span> <span class="st">"Boosting - Logistic"</span>, estimate <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">.estimate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run on one sample to demonstrate: </span></span>
<span><span class="va">paired_class_bt</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">metric_diff</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   term                estimate</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Boosting - Logistic -0.01240</span></span>
<span></span>
<span><span class="co"># Run on all:</span></span>
<span><span class="va">paired_class_bt</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">paired_class_bt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>stats <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">splits</span>, <span class="va">metric_diff</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">int_pctl</span><span class="op">(</span><span class="va">paired_class_bt</span>, <span class="va">stats</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   term                   .lower .estimate  .upper .alpha .method   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 Boosting - Logistic -0.005106  0.006411 0.01823    0.1 percentile</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://aml4td.org/chapters/comparing-models.html#sec-compare-holdout"><i class="fa-solid fa-rotate-left fa-small" aria-label="rotate-left"></i></a></p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>“GLHT” stands for “General Linear Hypothesis Tests.”<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>“MCP” presumably stands for “Multiple Comparison Procedure.”<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/tidymodels\.aml4td\.org\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/feature-selection.html" class="pagination-link" aria-label="Feature Selection">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Feature Selection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/cls-metrics.html" class="pagination-link" aria-label="Characterizing Classification Models">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Characterizing Classification Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>