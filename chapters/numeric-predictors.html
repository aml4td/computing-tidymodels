<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.22">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Tidymodels Computing Supplement – 4&nbsp; Transforming Numeric Predictors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/categorical-predictors.html" rel="next">
<link href="../chapters/initial-data-splitting.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-numeric-predictors" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transforming Numeric Predictors</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../"></a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/aml4td/computing-tidymodels/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/news.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Preparation</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/initial-data-splitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Initial Data Splitting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/numeric-predictors.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transforming Numeric Predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/categorical-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Categorical Predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/embeddings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Embeddings</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/interactions-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactions and Nonlinear Features</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Optmization</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Overfitting</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Classification</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Regression</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Characterization</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Finalization</span></span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#requirements" id="toc-requirements" class="nav-link active" data-scroll-target="#requirements"><span class="header-section-number">4.1</span> Requirements</a></li>
  <li><a href="#sec-hotel-data-intro" id="toc-sec-hotel-data-intro" class="nav-link" data-scroll-target="#sec-hotel-data-intro"><span class="header-section-number">4.2</span> Data Sets</a></li>
  <li><a href="#sec-r-formulas" id="toc-sec-r-formulas" class="nav-link" data-scroll-target="#sec-r-formulas"><span class="header-section-number">4.3</span> Standard R Formulas</a></li>
  <li><a href="#sec-recipe-intro" id="toc-sec-recipe-intro" class="nav-link" data-scroll-target="#sec-recipe-intro"><span class="header-section-number">4.4</span> What is a Recipe?</a></li>
  <li><a href="#sec-recipe-skewness" id="toc-sec-recipe-skewness" class="nav-link" data-scroll-target="#sec-recipe-skewness"><span class="header-section-number">4.5</span> Resolving Skewness</a></li>
  <li><a href="#sec-recipe-selectors" id="toc-sec-recipe-selectors" class="nav-link" data-scroll-target="#sec-recipe-selectors"><span class="header-section-number">4.6</span> More on Recipe Selectors</a></li>
  <li><a href="#sec-recipe-standardize" id="toc-sec-recipe-standardize" class="nav-link" data-scroll-target="#sec-recipe-standardize"><span class="header-section-number">4.7</span> Standardizing to a common scale</a></li>
  <li><a href="#sec-recipe-spatialp-sign" id="toc-sec-recipe-spatialp-sign" class="nav-link" data-scroll-target="#sec-recipe-spatialp-sign"><span class="header-section-number">4.8</span> Spatial Sign</a></li>
  <li><a href="#sec-recipe-resources" id="toc-sec-recipe-resources" class="nav-link" data-scroll-target="#sec-recipe-resources"><span class="header-section-number">4.9</span> Other resources for learning about recipes</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-numeric-predictors" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transforming Numeric Predictors</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>The corresponding <a href="https://aml4td.org/chapters/numeric-predictors.html">book chapter</a> is concerned with operations to improve how numeric predictor variables are represented in the data prior to modeling. We separate these operations into two categories:</p>
<ul>
<li>
<em>preprocessing</em> methods are actions that the <em>model requires</em> such as standardization of variables.</li>
<li>
<em>feature engineering</em> transformations are those that your particular data set requires to predict the outcome successfully.</li>
</ul>
<p>In either case, we estimate these transformations exclusively from the training set and apply them to any data (e.g., the training set, test set, and/or new or unknown data). This is generally true and applies to upcoming chapters on categorical data and other transformations.</p>
<p>In tidymodels, just about everything you want to do to your predictors can be accomplished using the R formula method or, better still, the <span class="pkg"><a href="https://cran.r-project.org/package=recipes">recipes</a></span> package. We shall describe both.</p>
<section id="requirements" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="requirements">
<span class="header-section-number">4.1</span> Requirements</h2>
<p>You’ll need 4 packages (<span class="pkg"><a href="https://cran.r-project.org/package=bestNormalize">bestNormalize</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=embed">embed</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=splines2">splines2</a></span>, and <span class="pkg"><a href="https://cran.r-project.org/package=tidymodels">tidymodels</a></span>) for this chapter. You can install them via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">req_pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bestNormalize"</span>, <span class="st">"embed"</span>, <span class="st">"tidymodels"</span>, <span class="st">"splines2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check to see if they are installed: </span></span>
<span><span class="va">pkg_installed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">req_pkg</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/is_installed.html">is_installed</a></span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install missing packages: </span></span>
<span><span class="kw">if</span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="op">!</span><span class="va">pkg_installed</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">install_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pkg_installed</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">pkg_installed</span><span class="op">]</span></span>
<span>  <span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html">pak</a></span><span class="op">(</span><span class="va">install_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s load the meta package and manage some between-package function conflicts.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-hotel-data-intro" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="sec-hotel-data-intro">
<span class="header-section-number">4.2</span> Data Sets</h2>
<p>The data sets used here are both in R packages that have already been installed. Let’s work with the primary data set: the Ames Iowa housing data.</p>
<p>In the last chapter, our manipulation and splitting code was:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ames</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">Bldg_Type</span>, <span class="va">Neighborhood</span>, <span class="va">Year_Built</span>, <span class="va">Gr_Liv_Area</span>, <span class="va">Full_Bath</span>,</span>
<span>         <span class="va">Half_Bath</span>, <span class="va">Year_Sold</span>, <span class="va">Lot_Area</span>, <span class="va">Central_Air</span>, <span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span>,</span>
<span>    Baths <span class="op">=</span> <span class="va">Full_Bath</span>  <span class="op">+</span> <span class="va">Half_Bath</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Half_Bath</span>, <span class="op">-</span><span class="va">Full_Bath</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3024</span><span class="op">)</span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span>, breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll work with <code>ames_train</code> almost exclusively here.</p>
</section><section id="sec-r-formulas" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="sec-r-formulas">
<span class="header-section-number">4.3</span> Standard R Formulas</h2>
<p>Model formulas in R are identical to those in S, which Chambers and Hastie introduced in <em>Statistical Models in S</em> (1991). A broader discussion can be found in two blog posts (<a href="https://rviews.rstudio.com/2017/02/01/the-r-formula-method-the-good-parts/">one</a> and <a href="https://rviews.rstudio.com/2017/03/01/the-r-formula-method-the-bad-parts/">two</a>).</p>
<p>The formula has a few basic operators:</p>
<ul>
<li>The tilde (<code>~</code>) separates the outcome columns from the predictor columns. Anything to the left is considered an outcome, and the right-hand side defines predictors (e.g., <code>outcome ~ predictor</code>
</li>
<li>A dot is a wildcard for any columns in the data set that are not outcomes (e.g., <code>y ~ .</code>).</li>
<li>Plus signs signify the symbolic addition of columns to the formula (typically predictors). For example, <code>y ~ x1 + x2</code> indicates one outcome and two predictor columns. To indicate arithmetic addition (or any other computations), you can wrap the items in the identity function <code><a href="https://rdrr.io/r/base/AsIs.html">I()</a></code> such as <code>y ~ I(x1 + x2)</code>.</li>
<li>You can use the minus sign to remove columns. This may not be implemented in some modeling functions.</li>
<li>The colon indicates interaction terms (described in a future chapter).</li>
</ul>
<p>There is further syntax described below.</p>
<p>Here’s an example of a basic formula that creates two predictor columns by specifying a symbolic formula comprised of two numeric predictors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_01</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Baths</span> <span class="op">+</span> <span class="va">Year_Built</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a short function to show basic results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">show_columns</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_01</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   `(Intercept)` Baths Year_Built</span></span>
<span><span class="co">#&gt;           &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             1   1         1961</span></span>
<span><span class="co">#&gt; 2             1   1.5       1971</span></span>
<span><span class="co">#&gt; 3             1   2         1962</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It does not use row-wise arithmetic additions of the two columns. To do that, you can use the identify function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># One slope term, not two</span></span>
<span><span class="va">f_02</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">Full_Bath</span> <span class="op">+</span> <span class="va">Half_Bath</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Symbolic addition creates separate columns of the data set. In chapter TODO, we’ll discuss <em>main effects</em> and <em>interactions</em>. The main effects are features composed of a single predictor (as in <code>f_01</code> above). Interaction effects are one or more model terms that combine the information of all the predictors in a multiplicative way. There are a few ways to specify them. Here are three methods for specifying two-factor interactions between predictors:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># `:` is used for specific interactions</span></span>
<span><span class="va">f_03</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Baths</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Baths</span><span class="op">:</span><span class="va">Year_Built</span></span>
<span></span>
<span><span class="co"># `*` is used to make all interactions of two or more terms</span></span>
<span><span class="va">f_04</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Baths</span> <span class="op">*</span> <span class="va">Year_Built</span></span>
<span></span>
<span><span class="co"># `()^D` makes interactions up to order D of all of the columns</span></span>
<span><span class="co"># within the parenthesis</span></span>
<span><span class="va">f_05</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="op">(</span><span class="va">Baths</span> <span class="op">+</span> <span class="va">Year_Built</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_05</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   `(Intercept)` Baths Year_Built `Baths:Year_Built`</span></span>
<span><span class="co">#&gt;           &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             1   1         1961              1961 </span></span>
<span><span class="co">#&gt; 2             1   1.5       1971              2956.</span></span>
<span><span class="co">#&gt; 3             1   2         1962              3924</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this data set, the right-hand side of <code>f_05</code> could be shortened to <code>(.)^2</code>.</p>
<p>Since <code>Baths</code> and <code>Year_Built</code> are both numeric, their interactions are created by simply multiplying their values, i.e., <code>I(Baths * Year_Built)</code>.</p>
<p>By default, the model formula creates an intercept column where the value of each row is 1.0. To prevent the intercept from being added, there are two syntaxes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_06</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Baths</span> <span class="op">-</span> <span class="fl">1</span> </span>
<span><span class="va">f_07</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Baths</span> <span class="op">+</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_07</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 1</span></span>
<span><span class="co">#&gt;   Baths</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1   1  </span></span>
<span><span class="co">#&gt; 2   1.5</span></span>
<span><span class="co">#&gt; 3   2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What happens with factor predictors? Their specification is the same:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_08</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Bldg_Type</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, <em>most of the time</em><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, the formula method creates columns of binary 0/1 to replace the original factor column. Since there are 5 possible values of <code>Bldg_Type</code>, the formula creates 4 columns of indicator variables, each corresponding to a specific level. The first factor level is excluded by default. This is discussed more in <a href="https://aml4td.org/chapters/categorical-predictors.html#sec-indicators"><em>Working with Categorical Predictors</em></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note that the resulting column names smash the original column</span></span>
<span><span class="co"># name an its factor level together with no delimiter. </span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_08</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   `(Intercept)` Bldg_TypeTwoFmCon Bldg_TypeDuplex Bldg_TypeTwnhs Bldg_TypeTwnhsE</span></span>
<span><span class="co">#&gt;           &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             1                 0               0              0               0</span></span>
<span><span class="co">#&gt; 2             1                 0               0              1               0</span></span>
<span><span class="co">#&gt; 3             1                 0               1              0               0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For interaction terms, the syntax is the same as the one shown above. In the case of categorical predictors, all combinations of the predictors are created. In the following case, <code>Central_Air</code> has two levels. A two-way interaction of these two predictors creates 4 <span class="math inline">\(\times\)</span> 1 = 4 interaction columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_09</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="op">(</span><span class="va">Bldg_Type</span> <span class="op">+</span> <span class="va">Central_Air</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_09</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 10</span></span>
<span><span class="co">#&gt;   `(Intercept)` Bldg_TypeTwoFmCon Bldg_TypeDuplex Bldg_TypeTwnhs Bldg_TypeTwnhsE</span></span>
<span><span class="co">#&gt;           &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             1                 0               0              0               0</span></span>
<span><span class="co">#&gt; 2             1                 0               0              1               0</span></span>
<span><span class="co">#&gt; 3             1                 0               1              0               0</span></span>
<span><span class="co">#&gt; # ℹ 5 more variables: Central_AirY &lt;dbl&gt;, `Bldg_TypeTwoFmCon:Central_AirY` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `Bldg_TypeDuplex:Central_AirY` &lt;dbl&gt;, `Bldg_TypeTwnhs:Central_AirY` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `Bldg_TypeTwnhsE:Central_AirY` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What happens when you exclude the intercept? All factor levels receive a binary indicator column for a single categorical predictor.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_10</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="va">Bldg_Type</span> <span class="op">+</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_10</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   Bldg_TypeOneFam Bldg_TypeTwoFmCon Bldg_TypeDuplex Bldg_TypeTwnhs Bldg_TypeTwnhsE</span></span>
<span><span class="co">#&gt;             &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1               1                 0               0              0               0</span></span>
<span><span class="co">#&gt; 2               0                 0               0              1               0</span></span>
<span><span class="co">#&gt; 3               0                 0               1              0               0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>However</em>, this may produce unexpected results when multiple factor predictors exist. The first factor in the formula creates all possible indicators (e.g., 5 for <code>Bldg_Type</code>) while the others have all but one factor level created. For example, these two formulas would have different columns:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_11</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Bldg_Type</span> <span class="op">+</span> <span class="va">Central_Air</span> <span class="op">+</span> <span class="fl">0</span></span>
<span><span class="va">f_12</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Central_Air</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_11</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Bldg_TypeDuplex"   "Bldg_TypeOneFam"   "Bldg_TypeTwnhs"    "Bldg_TypeTwnhsE"  </span></span>
<span><span class="co">#&gt; [5] "Bldg_TypeTwoFmCon" "Central_AirY"</span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_12</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Bldg_TypeDuplex"   "Bldg_TypeTwnhs"    "Bldg_TypeTwnhsE"   "Bldg_TypeTwoFmCon"</span></span>
<span><span class="co">#&gt; [5] "Central_AirN"      "Central_AirY"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There model predictions and <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> results will be the same but the interpretation of their coefficients will be very different.</p>
<p>You can use in-line functions within a recipe. For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wwenjie.org/splines2">splines2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'splines2' was built under R version 4.3.3</span></span>
<span><span class="va">f_13</span> <span class="op">&lt;-</span> <span class="va">Sale_Price</span> <span class="op">~</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">Lot_Area</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://wwenjie.org/splines2/reference/naturalSpline.html">naturalSpline</a></span><span class="op">(</span><span class="va">Latitude</span>, df <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_columns</span><span class="op">(</span><span class="va">f_13</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span><span class="co">#&gt;   `(Intercept)` `log(Gr_Liv_Area)` `scale(Lot_Area)`</span></span>
<span><span class="co">#&gt;           &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             1              6.798            0.1994</span></span>
<span><span class="co">#&gt; 2             1              6.895           -1.103 </span></span>
<span><span class="co">#&gt; 3             1              7.455            0.4139</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: `naturalSpline(Latitude, df = 3)1` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `naturalSpline(Latitude, df = 3)2` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `naturalSpline(Latitude, df = 3)3` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>uses three in-line functions:</p>
<ol type="1">
<li>The first is a simple log transformation of the gross living area.</li>
<li>The use of <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> will compute the mean and standard deviation of <code>Lot_Area</code> and use those to center and scale that column.</li>
<li>The function <code><a href="https://wwenjie.org/splines2/reference/naturalSpline.html">splines2::naturalSpline()</a></code> will create a set of basis functions (described in chapter TODO) that will replace the original <code>Latitude</code> column.</li>
</ol>
<p>In the second and third cases, R’s machinery will estimate the relevant statistics and embed them as attributes in the corresponding columns. For each in-line function, the exact same operations are conducted on new data (say when <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> is called).</p>
<p>Finally, be aware that each formula captures the environment in which it was created. For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">f_12</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span>
<span></span>
<span><span class="co"># The number of objects in the session used to create this web page (up to now):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">f_12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 22</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If an object that used <code>f_12</code> is saved to disk, it will also contain the 22 objects in the global environment. If any of these objects are large, it can unintentionally make the saved data object large. Note that using the base function <code><a href="https://rdrr.io/r/utils/object.size.html">object.size()</a></code> will not take into account anything stored in the environment (so the binary file size is underestimated). <code><a href="https://lobstr.r-lib.org/reference/obj_size.html">lobstr::obj_size()</a></code> will give a more accurate estimate.</p>
<p>The <span class="pkg"><a href="https://cran.r-project.org/package=butcher">butcher</a></span> package has tools to strip off these unneeded objects from formulas (or objects that contain formulas). Also, <code><a href="https://butcher.tidymodels.org/reference/weigh.html">butcher::weigh()</a></code> returns a tibble with the size of each element contained in the object (if any).</p>
</section><section id="sec-recipe-intro" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="sec-recipe-intro">
<span class="header-section-number">4.4</span> What is a Recipe?</h2>
<p>A recipe is a set of sequential steps that specify what operations should be conducted on a set of predictors. Operations could include:</p>
<ul>
<li>Modifying a predictor’s encoding (e.g., date to month/day/year columns)</li>
<li>Adding new features, such as basis expansions.</li>
<li>Standardizing or transforming individual predictors.</li>
<li>Feature extraction or embeddings on multiple predictors.<br>
</li>
<li>Removing features.</li>
</ul>
<p>Recipes can be used by themselves or as part of a modeling pipeline. For illustration, we’ll show how to use them directly. The process is to</p>
<pre><code>specify -&gt; estimate -&gt; apply</code></pre>
<p>the recipe. In terms of syntax, the analogous functions are:</p>
<pre><code>recipe() -&gt; prep() -&gt; bake()</code></pre>
<p>We’ll start simply by trying to “unskew” a predictor’s distribution.</p>
</section><section id="sec-recipe-skewness" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="sec-recipe-skewness">
<span class="header-section-number">4.5</span> Resolving Skewness</h2>
<p>The main text mentions that the distribution of the <code>Lot_Area</code> variable is skewed. Let’s see what that looks like.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Lot_Area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, col <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"#8E195C"</span>, alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_rug</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>, length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.03</span>, <span class="st">"npc"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Lot Area"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../figures/lot-area-skew-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>To get started, we initialize a recipe with the <code>recipe()</code> function and a data set:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">unskew_rec</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The formula method doesn’t do much here: it records the outcome (columns to the left of <code>~</code>), which are predictors (to the right of <code>~</code> ), and their data types. Note that the <code>.</code> in the formula means that all columns, except those to the left, should be considered predictors. When using a formula to start a recipe, keep it simple. It won’t accept any in-line functions (like <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code> or <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code>); it wants you to change the variables inside of <em>recipe steps</em>.</p>
<p>Regarding the <code>data</code> argument: <em>any</em> data set with the appropriate columns could be used. The initial recipe work is just cataloging the columns. You could even use a “zero row slice” such as <code>ames_train[0,]</code> and get the same results. You might want to do something like this if you have a very large training set (to reduce the in-memory footprint). The main advantage of using <code>ames_train</code> is convenience (as we’ll see later).</p>
<p>We’ll add different recipe step functions from this initial object to declare what we want to do. Let’s say we will transform the lot area column using the Yeo-Johnsom transformation. To do this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">unskew_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_YeoJohnson</span><span class="op">(</span><span class="va">Lot_Area</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or use a dplyr selector:</span></span>
<span><span class="va">unskew_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_YeoJohnson</span><span class="op">(</span><span class="fu">any_of</span><span class="op">(</span><span class="st">"Lot_Area"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unskew_rec</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Recipe ───────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; outcome:    1</span></span>
<span><span class="co">#&gt; predictor: 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; • Yeo-Johnson transformation on: any_of("Lot_Area")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or <code>starts_with("Lot_")</code> and so on.</p>
<p>This only specifies what we want to do. Recall that the Yeo-Johnson transformation <em>estimates</em> a transformation parameter from the data. To estimate the recipe, use <code>prep()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">unskew_rec</span> <span class="op">&lt;-</span> <span class="fu">prep</span><span class="op">(</span><span class="va">unskew_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or, to use a different data set: </span></span>
<span><span class="va">unskew_rec</span> <span class="op">&lt;-</span> <span class="fu">prep</span><span class="op">(</span><span class="va">unskew_rec</span>, training <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in prep(unskew_rec, training = ames_train): ! The previous data will be used by `prep()`.</span></span>
<span><span class="co">#&gt; ℹ The data passed using `training` will be ignored.</span></span>
<span><span class="va">unskew_rec</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Recipe ───────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; outcome:    1</span></span>
<span><span class="co">#&gt; predictor: 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Training information</span></span>
<span><span class="co">#&gt; Training data contained 2196 data points and no incomplete rows.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; • Yeo-Johnson transformation on: Lot_Area | Trained</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the printed recipe shows that <code>Lot_Area</code> was resolved from the original request for <code>any_of("Lot_Area")</code>.</p>
<p>What was the estimate of the transformation parameter? The <code>tidy()</code> method can tell us:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get the list of steps: </span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">unskew_rec</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   number operation type       trained skip  id              </span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;lgl&gt;   &lt;lgl&gt; &lt;chr&gt;           </span></span>
<span><span class="co">#&gt; 1      1 step      YeoJohnson TRUE    FALSE YeoJohnson_VL1H3</span></span>
<span></span>
<span><span class="co"># Get information about the first step: </span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">unskew_rec</span>, number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   terms     value id              </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;           </span></span>
<span><span class="co">#&gt; 1 Lot_Area 0.1503 YeoJohnson_VL1H3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have a trained recipe, we can use it via <code>bake()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get the list of steps: </span></span>
<span><span class="fu">bake</span><span class="op">(</span><span class="va">unskew_rec</span>, new_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ames_train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 11</span></span>
<span><span class="co">#&gt;   Bldg_Type Neighborhood    Year_Built Gr_Liv_Area Year_Sold Lot_Area Central_Air</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;                &lt;int&gt;       &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt; &lt;fct&gt;      </span></span>
<span><span class="co">#&gt; 1 OneFam    North_Ames            1961         896      2010    20.52 Y          </span></span>
<span><span class="co">#&gt; 2 OneFam    North_Ames            1971         864      2010    20.11 Y          </span></span>
<span><span class="co">#&gt; 3 Twnhs     Briardale             1971         987      2010    13.67 Y          </span></span>
<span><span class="co">#&gt; 4 Twnhs     Briardale             1971        1092      2010    13.67 Y          </span></span>
<span><span class="co">#&gt; 5 Twnhs     Northpark_Villa       1975         836      2010    14.62 Y          </span></span>
<span><span class="co">#&gt; 6 OneFam    Sawyer_West           1920        1012      2010    19.83 N          </span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;, Baths &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Sale_Price &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Did it work? Let’s look at the whole training set:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">unskew_rec</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bake</span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Lot_Area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_rug</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>, length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.03</span>, <span class="st">"npc"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, col <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"#8E195C"</span>, alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Lot Area"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../figures/lot-area-unskew-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>One shortcut we can take: the recipe has to apply each step to the training data after it estimates the step. By default, the recipe object saves the processed version of the data set. This can be turned off using the <code>retain = FALSE</code> option to <code>prep()</code>. Since the training set is already in the recipe, we can get it with no additional computations using</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">bake</span><span class="op">(</span><span class="va">unskew_rec</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The main site mentions a few other methods that could be used besides Yeo-Johnson:</p>
<ul>
<li>Box-Cox: <code>step_BoxCox()</code>
</li>
<li>Percentile: <code>step_percentile()</code>
</li>
<li>orderNorm: <code><a href="https://petersonr.github.io/bestNormalize/reference/step_orderNorm.html">step_orderNorm()</a></code>
</li>
</ul>
<p>Note that the last method has its step function in the <span class="pkg"><a href="https://cran.r-project.org/package=bestNormalize">bestNormalize</a></span> package; various recipe extension packages can be used. A <a href="https://www.tidymodels.org/find/recipes/"><strong>full set of recipe steps</strong></a> for CRAN packages is available on <code>tidymodels.org</code>.</p>
<p>There is also a general step for <em>simple</em> computations that do not need to be estimated. If we were to log transform the data, we would use:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_mutate</span><span class="op">(</span>Lot_Area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Lot_Area</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Other single variable transformations can be found in the following R packages: <span class="pkg"><a href="https://cran.r-project.org/package=car">car</a></span>, <span class="pkg"><a href="https://cran.r-project.org/package=trafo">trafo</a></span>, and <span class="pkg"><a href="https://cran.r-project.org/package=Transform">Transform</a></span>.</p>
</section><section id="sec-recipe-selectors" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="sec-recipe-selectors">
<span class="header-section-number">4.6</span> More on Recipe Selectors</h2>
<p>The previous section showed a recipe step that operated on a single column. You can select one or more predictors in a variety of different ways within a recipe:</p>
<ul>
<li>Bare, unquoted column names such as <code>Lot_Area</code>.</li>
<li>
<span class="pkg"><a href="https://cran.r-project.org/package=dplyr">dplyr</a></span> package selectors, including <code>starts_with()</code>, <code>contained()</code>, and so on.</li>
<li>Special, recipe-only selectors:
<ul>
<li>Role-based: <code>all_predictors()</code>, <code>all_outcomes()</code>, and so on.</li>
<li>Type-based: <code>all_numeric()</code>, <code>all_factor()</code>, …</li>
<li>Combinations: <code>all_numeric_predictors()</code> etc.</li>
</ul>
</li>
</ul>
<p>Two important <span class="pkg"><a href="https://cran.r-project.org/package=dplyr">dplyr</a></span> selectors are <code>all_of()</code> and <code>any_of()</code>. These take character vectors of column names as inputs. <code>all_of()</code> will select all of the columns in the vector and will fail if they are not all present when the recipe step is executed. <code>any_of()</code> will select any of the columns that are given and won’t fail, even if none are available.</p>
<p>This is important for a few reasons. Some steps can combine or eliminate columns. A recipe should be fault tolerant; if the previous step removed column <code>A</code> and the next step strictly requires it, it will fail. However, if <code>any_of(c("A"))</code> is used, it will not <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>There is a <a href="https://recipes.tidymodels.org/reference/selections.html">documentation page</a> for recipe selectors as well as the <a href="https://recipes.tidymodels.org/reference/has_role.html">reference page</a>.</p>
</section><section id="sec-recipe-standardize" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="sec-recipe-standardize">
<span class="header-section-number">4.7</span> Standardizing to a common scale</h2>
<p>The two main steps for standardizing columns to have the same units are <code>step_normalize()</code> and <code>step_range()</code>. A common pattern for the former is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">norm_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">unskew_rec</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">norm_rec</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Recipe ───────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; outcome:    1</span></span>
<span><span class="co">#&gt; predictor: 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Training information</span></span>
<span><span class="co">#&gt; Training data contained 2196 data points and no incomplete rows.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; • Yeo-Johnson transformation on: Lot_Area | Trained</span></span>
<span><span class="co">#&gt; • Zero variance filter on: all_predictors()</span></span>
<span><span class="co">#&gt; • Centering and scaling for: all_numeric_predictors()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>step_zv()</code> is for removing “zero-variance” (zv) predictors. These are columns with a single unique value. Since <code>step_normalize()</code> will try to divide by a column’s standard deviation, this will fail if there is no variation in the column. <code>step_zv()</code> will remove such columns that exist in the training set.</p>
<p>We recycled the previous recipe, which has already been trained. Note that in the output above, only the first step is labeled as “<code>Trained</code>”. When we run <code>prep()</code> on this recipe, it only estimates the remaining two steps.</p>
<p>Again, once we prep(are) the recipe, we can use <code>bake()</code> to get the normalized data.</p>
<p>Another important point is that recipes are designed to utilize different data sets appropriately. The training set is used with <code>prep()</code> and ensures that all the estimations are based on it. There is, as is appropriate, no re-estimation of quantities when new data are processed.</p>
</section><section id="sec-recipe-spatialp-sign" class="level2" data-number="4.8"><h2 data-number="4.8" class="anchored" data-anchor-id="sec-recipe-spatialp-sign">
<span class="header-section-number">4.8</span> Spatial Sign</h2>
<p>Unsurprisingly, the step to compute the spatial sign is <code>step_spatialsign()</code>. It projects two or more numeric columns onto a multidimensional hypersphere. The resulting data has columns the same name as the input:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://petersonr.github.io/bestNormalize/">bestNormalize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp_sign_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Lot_Area</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_YeoJohnson</span><span class="op">(</span><span class="fu">any_of</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lot_Area"</span>, <span class="st">"Gr_Liv_Area"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://petersonr.github.io/bestNormalize/reference/step_orderNorm.html">step_orderNorm</a></span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_spatialsign</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp_sign_data</span> <span class="op">&lt;-</span> <span class="fu">bake</span><span class="op">(</span><span class="va">sp_sign_rec</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">sp_sign_data</span></span>
<span><span class="co">#&gt; # A tibble: 2,196 × 3</span></span>
<span><span class="co">#&gt;   Lot_Area Gr_Liv_Area Sale_Price</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1   0.4496     -0.8932      5.021</span></span>
<span><span class="co">#&gt; 2   0.2349     -0.9720      5.061</span></span>
<span><span class="co">#&gt; 3  -0.9012     -0.4334      4.982</span></span>
<span><span class="co">#&gt; 4  -0.9474     -0.3199      4.944</span></span>
<span><span class="co">#&gt; 5  -0.7424     -0.6700      5.079</span></span>
<span><span class="co">#&gt; 6   0.1537     -0.9881      4.829</span></span>
<span><span class="co">#&gt; # ℹ 2,190 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sp_sign_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Lot_Area</span>, <span class="va">Gr_Liv_Area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>cex <span class="op">=</span>  <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../figures/sp-sign-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-recipe-resources" class="level2" data-number="4.9"><h2 data-number="4.9" class="anchored" data-anchor-id="sec-recipe-resources">
<span class="header-section-number">4.9</span> Other resources for learning about recipes</h2>
<ul>
<li>
<code>tidymodels.org</code>: <a href="https://www.tidymodels.org/start/recipes/"><em>Preprocess your data with recipes</em></a>
</li>
<li>
<em>TMwR</em> chapter: <a href="https://www.tmwr.org/recipes"><em>Feature Engineering with recipes</em></a>
</li>
<li>
<em>TMwR</em> chapter: <a href="https://www.tmwr.org/dimensionality"><em>Dimensionality Reduction</em></a>
</li>
<li>2023 Posit conference workshop slides: <a href="https://workshops.tidymodels.org/archive/2023-09-posit-conf/intro-extra-recipes.html"><em>Intro: Using recipes</em></a>
</li>
<li>2023 Posit conference workshop slides: <a href="https://workshops.tidymodels.org/archive/2023-09-posit-conf/advanced-02-feature-engineering.html#/title-slide"><em>Feature engineering using recipes</em></a>
</li>
<li><a href="https://recipes.tidymodels.org/articles/Roles.html"><em>Roles in recipes</em></a></li>
<li><a href="https://recipes.tidymodels.org/articles/Ordering.html"><em>Ordering of steps</em></a></li>
<li>Stackoverflow Questions tagged <a href="https://stackoverflow.com/questions/tagged/r-recipes"><code>[r-recipes]</code></a>
</li>
</ul>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Some model functions require these binary indicators, and others do not. You should assume they convert factor predictors to binary indicators; we will alter you when a specific function does not.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>More accurately, it will <em>probably</em> be fine. Most steps are permissive; others are not. The previously described <code>step_mutate()</code> would fail if <code>Lot_Area</code> was previously eliminated.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tidymodels\.aml4td\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/initial-data-splitting.html" class="pagination-link" aria-label="Initial Data Splitting">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Initial Data Splitting</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/categorical-predictors.html" class="pagination-link" aria-label="Working with Categorical Predictors">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Categorical Predictors</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>